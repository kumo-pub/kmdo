---
slug: /cmd/pkg/init
---


# kmdo pkg init 命令文档
## 概述
kmdo pkg init 命令用于为项目生成 .kmdopkg.yaml 配置文件（kmdo 包管理核心配置），支持自动识别项目开发语言并生成对应示例配置，同时更新 .gitignore 文件以忽略构建产物等无关目录，适配 Go、Rust、Zig 等多种语言项目。

## 命令结构
kmdo pkg init [FLAGS]
kmdo pkg i [FLAGS]  # 简写形式

## 核心功能
1. 生成 .kmdopkg.yaml 配置文件，默认按项目语言生成示例配置。
2. 自动识别项目开发语言（通过检测特征文件，如 Cargo.toml 对应 Rust）。
3. 自动更新 .gitignore 文件，添加语言专属构建产物目录（如 target/ 对应 Rust）。
4. 支持自定义配置文件路径和指定开发语言，覆盖自动识别结果。

## 命令 Flags 说明
| Flag | 简写 | 类型 | 默认值 | 描述 |
|------|------|------|--------|------|
| --language | -l | 字符串 | "go" | 指定项目开发语言（支持值：go、bun、deno、rust、zig、uv、poetry） |
| --config | -f | 字符串 | ".kmdopkg.yaml" | 配置文件输出路径（支持 yaml/yml 格式） |

## 语言自动识别规则
命令会通过检测项目根目录下的特征文件自动判断语言，优先级如下：
| 语言 | 检测条件 |
|------|----------|
| zig | 存在 build.zig 文件 |
| rust | 存在 Cargo.toml 文件 |
| bun | 存在 bun.lockb 文件，或 package.json 中 devDependencies 包含 @types/bun |
| deno | 存在 deno.json 文件 |
| poetry | 存在 pyproject.toml 文件且包含 [tool.poetry] 配置 |
| uv | 存在 pyproject.toml 文件（未匹配 poetry 时） |
| go | 未检测到上述文件时的默认语言 |

## 详细使用场景与说明
### 场景1：默认生成配置（自动识别语言）
#### 功能
自动检测项目语言，生成对应 .kmdopkg.yaml 示例配置，并更新 .gitignore。
#### 用法
kmdo pkg init
# 或简写
kmdo pkg i
#### 示例（Go 项目）
# 执行命令后输出
ℹ️  project contains no language-specific files, using default go configuration
ℹ️  generating .kmdopkg.yaml
ℹ️  setting up .gitignore
✅ done! please edit .kmdopkg.yaml and .gitignore accordingly.

# 生成的 .gitignore 新增内容
# Added by kmdo pkg init:
dist/

### 场景2：指定语言生成配置
#### 功能
手动指定项目语言，忽略自动识别结果，生成对应示例配置。
#### 用法
```shell
kmdo pkg init --language <语言>
# 或简写
kmdo pkg i -l <语言>
#### 示例（Rust 项目）
kmdo pkg init -l rust
```
# 输出
ℹ️  generating .kmdopkg.yaml
ℹ️  setting up .gitignore
✅ done! please edit .kmdopkg.yaml and .gitignore accordingly.

# 生成的 .gitignore 新增内容
# Added by kmdo pkg init:
dist/
.intentionally-empty-file.o
target/

### 场景3：自定义配置文件路径
#### 功能
指定 .kmdopkg.yaml 的输出路径，适用于需要自定义配置文件名的场景。
#### 用法
```shell
kmdo pkg init --config <自定义路径>
# 或简写
kmdo pkg i -f <自定义路径>
#### 示例
kmdo pkg init -f ./configs/kmdo-pkg.yaml
```

# 输出
ℹ️  generating configs/kmdo-pkg.yaml
ℹ️  setting up .gitignore
✅ done! please edit configs/kmdo-pkg.yaml and .gitignore accordingly.

## 关键行为说明
### 1. 配置文件已存在时
若指定路径下已存在 .kmdopkg.yaml（或自定义配置文件），命令会直接报错，需删除现有文件后重新执行：
error: .kmdopkg.yaml already exists, delete it and run the command again

### 2. .gitignore 处理规则
- 若项目中无 .gitignore 文件，自动创建并添加语言专属忽略规则。
- 若已存在 .gitignore，仅添加缺失的规则（不会覆盖现有内容）。
- 所有添加的规则会以 "# Added by kmdo pkg init:" 注释区分，便于识别。

### 3. 各语言专属 .gitignore 规则
| 语言 | 新增忽略规则 |
|------|--------------|
| go | dist/ |
| rust | dist/、.intentionally-empty-file.o、target/ |
| zig | dist/、.intentionally-empty-file.o、zig-out/、.zig-cache/ |
| bun | dist/ |
| deno | dist/ |
| uv | dist/、build/ |
| poetry | dist/ |

## 注意事项
1. 语言参数限制：--language 仅支持指定的 7 种语言（go/bun/deno/rust/zig/uv/poetry），输入其他值会报错。
2. 配置文件权限：生成的 .kmdopkg.yaml 权限为 0644（所有者可读写，其他用户只读）。
3. 目录创建：若自定义配置文件路径包含不存在的目录（如 ./configs/），命令会报错，需提前创建目录。

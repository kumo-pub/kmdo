---
slug: /cmd/mirror/merge
---
# *kmdo mirror merge 命令文档
## 概述
kmdo mirror merge 命令用于将一个或多个源镜像仓库中的二进制组件、部署文件及版本元数据，合并到当前本地镜像仓库。支持自动处理重复冲突（如优先保留较新版本），保障数据一致性，适用于将多个上游源的制品聚合到统一本地镜像，实现集中化管理。该功能计划在 kmdo 0.9+ 版本正式支持。

## 命令结构
kmdo mirror merge [SOURCE_MIRROR] [--options]

## 核心功能
1. 从指定源镜像（SOURCE_MIRROR）拉取组件、部署文件及版本元数据。
2. 将拉取的内容合并到当前配置的本地镜像仓库。
3. 自动处理重复冲突：默认优先保留较新版本的组件，避免数据冗余或冲突。
4. 保持元数据完整性：合并过程中保留组件的版本记录、发布渠道、哈希值等关键信息。

## 适用场景
1. 聚合多个上游镜像的制品（如官方镜像+自定义镜像），统一本地管理。
2. 同步不同团队维护的组件镜像，整合为项目专属本地镜像。
3. 定期合并上游镜像更新，确保本地镜像包含最新组件版本。

## 命令说明
### 用法
# 基础用法（合并单个源镜像）
```shell
kmdo mirror merge <SOURCE_MIRROR>

# 合并多个源镜像（假设支持多参数传递）
kmdo mirror merge <SOURCE_MIRROR_1> <SOURCE_MIRROR_2> [--options]

# 结合选项使用（具体选项待 0.9+ 版本补充）
kmdo mirror merge <SOURCE_MIRROR> [--options]

### 示例（基于功能推测）
# 合并单个源镜像到本地
kmdo mirror merge https://github.com/kumose/upstream-mirror.git

# 合并多个源镜像，指定冲突时保留本地版本（假设支持 --prefer-local 选项）
kmdo mirror merge https://github.com/kumose/mirror-1.git https://github.com/kumose/mirror-2.git --prefer-local

# 合并指定组件（假设支持 --component 筛选选项）
kmdo mirror merge https://github.com/kumose/upstream-mirror.git --component mycomponent
```
## 前置条件
1. 功能可用性：需升级 kmdo 至 0.9+ 版本（低版本暂不支持）。
2. 本地镜像配置：已通过 `kmdo mirror set` 配置有效的本地镜像工作区（可通过 `kmdo mirror show` 确认）。
3. 源镜像可达：源镜像（SOURCE_MIRROR）需为可访问的镜像仓库地址（HTTP/SSH 协议均可），且网络通畅。
4. 认证配置：若源镜像需身份验证，需提前配置好认证信息（如 SSH 密钥、Git 用户名密码等）。

## 注意事项
1. 冲突处理规则：默认逻辑为“新版本优先”，即相同组件存在多个版本时，自动保留最新版本；具体规则可能通过后续选项配置，以 0.9+ 版本正式文档为准。
2. 数据安全性：合并前建议通过 `kmdo mirror status` 确认本地镜像状态（如无未提交变更），避免合并过程中覆盖本地重要数据。
3. 源镜像格式：源镜像需与 kmdo 镜像规范兼容（即通过 kmdo 发布的镜像），否则可能导致合并失败或数据不完整。
4. 选项补充：--options 具体参数（如冲突处理策略、组件筛选、增量合并等）将在 0.9+ 版本发布时补充，可参考在线文档获取最新信息。
5. 在线文档：详细使用说明可访问 https://docs.kumose.cc/kmdo/docs/cmd/mirror/merge 查看。

## 待补充说明（0.9+ 版本发布后更新）
- 支持的 --options 列表及功能描述（如冲突处理选项、组件/版本筛选、合并日志等）。
- 源镜像的支持格式（如 Git 仓库地址、本地镜像路径等）。
- 合并失败的常见原因及排查方案（如网络问题、源镜像不兼容、权限不足等）。
- 合并后的数据校验方法（如确认组件完整性、版本一致性）。
"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[660],{4028:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tutorial/pub/sign/docker_sign","title":"Signing Docker Images and Manifests","description":"Signing Docker Images and Manifests is also possible with Kmdo.","source":"@site/docs/tutorial/pub/sign/docker_sign.mdx","sourceDirName":"tutorial/pub/sign","slug":"/tutorial/pub/sign/docker_sign","permalink":"/kmdo/docs/tutorial/pub/sign/docker_sign","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Signing Binaries","permalink":"/kmdo/docs/tutorial/pub/sign/binary_sign"}}');var s=i(4848),a=i(8453);const o={},r="Signing Docker Images and Manifests",l={},c=[{value:"Available variable names",id:"available-variable-names",level:3},{value:"Common usage example",id:"common-usage-example",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",sup:"sup",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"signing-docker-images-and-manifests",children:"Signing Docker Images and Manifests"})}),"\n",(0,s.jsxs)(n.p,{children:["Signing Docker Images and Manifests is also possible with Kmdo.\nThis pipe was designed based on the common ",(0,s.jsx)(n.a,{href:"/kmdo/docs/tutorial/pub/sign/",children:"sign"})," pipe\nhaving ",(0,s.jsx)(n.a,{href:"https://github.com/sigstore/cosign",children:"cosign"})," in mind."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"Note that this pipe will run only at the end of the Kmdo execution (in\nits publishing phase), as cosign will change the image in the registry."})}),"\n",(0,s.jsx)(n.p,{children:"To customize the signing pipeline you can use the following options:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'docker_signs:\n  - # ID of the sign config, must be unique.\n    # Only relevant if you want to produce some sort of signature file.\n    #\n    # Default: \'default\'.\n    id: foo\n\n    # Path to the signature command.\n    #\n    # Default: \'cosign\'.\n    cmd: cosign\n\n    # Command line arguments for the command.\n    #\n    # Default: ["sign", "--key=cosign.key", "${artifact}@${digest}", "--yes"].\n    # Templates: allowed.\n    args:\n      - "sign"\n      - "--key=cosign.key"\n      - "--upload=false"\n      - "${artifact}"\n      - "--yes" # needed on cosign 2.0.0+\n\n    # Which artifacts to sign.\n    #\n    #   all:       all artifacts\n    #   none:      no signing\n    #   images:    only docker images\n    #   manifests: only docker manifests\n    #   \'\':        images built by dockers_v2\n    #\n    # Default: \'\'.\n    artifacts: all\n\n    # IDs of the artifacts to sign.\n    ids:\n      - foo\n      - bar\n\n\n    # Stdin data to be given to the signature command as stdin.\n    #\n    # Templates: allowed.\n    stdin: "{{ .Env.COSIGN_PWD }}"\n\n    # StdinFile file to be given to the signature command as stdin.\n    stdin_file: ./.password\n\n    # List of environment variables that will be passed to the signing command\n    # as well as the templates.\n    env:\n      - FOO=bar\n      - HONK=honkhonk\n\n    # By default, the stdout and stderr of the signing cmd are discarded unless\n    # Kmdo is running with `--verbose` set.\n    # You can set this to true if you want them to be displayed regardless.\n    output: true\n'})}),"\n",(0,s.jsx)(n.h3,{id:"available-variable-names",children:"Available variable names"}),"\n",(0,s.jsx)(n.p,{children:"These environment variables might be available in the fields that are templateable:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${artifact}"}),(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})}),": the path to the artifact that will be signed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${digest}"}),(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-2",id:"user-content-fnref-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})}),": the digest of the image/manifest that will be signed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${artifactID}"}),": the ID of the artifact that will be signed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${certificate}"}),": the certificate file name, if provided"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"common-usage-example",children:"Common usage example"}),"\n",(0,s.jsxs)(n.p,{children:["Assuming you have a ",(0,s.jsx)(n.code,{children:"cosign.key"})," in the repository root and a ",(0,s.jsx)(n.code,{children:"COSIGN_PWD"}),"\nenvironment variable, the simplest configuration to sign both Docker images\nand manifests would look like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'docker_signs:\n  - artifacts: all\n    stdin: "{{ .Env.COSIGN_PWD }}"\n'})}),"\n",(0,s.jsx)(n.p,{children:"Later on you (and anyone else) can verify the image with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cosign verify --key cosign.pub your/image\n"})}),"\n","\n",(0,s.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,s.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{id:"user-content-fn-1",children:["\n",(0,s.jsxs)(n.p,{children:["notice that this might contain ",(0,s.jsx)(n.code,{children:"/"})," characters, which depending on how\nyou use it might evaluate to actual paths within the file system. Use with\ncare. ",(0,s.jsx)(n.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{id:"user-content-fn-2",children:["\n",(0,s.jsxs)(n.p,{children:["those are extracted automatically when running Docker push from within\nKmdo. Using the digest helps making sure you're signing the right image\nand avoid concurrency issues. ",(0,s.jsx)(n.a,{href:"#user-content-fnref-2","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var t=i(6540);const s={},a=t.createContext(s);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);
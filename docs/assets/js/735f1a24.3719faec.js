"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2736],{6867:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>d,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"cookbook/builds-complex-envs","title":"Builds: using complex template environment variables","description":"Builds\' environment variables accept templates.","source":"@site/docs/cookbook/builds-complex-envs.mdx","sourceDirName":"cookbook","slug":"/cookbook/builds-complex-envs","permalink":"/kmdo/docs/cookbook/builds-complex-envs","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"cookBookSidebar","previous":{"title":"Building Go modules","permalink":"/kmdo/docs/cookbook/build-go-modules"},"next":{"title":"Cross-compiling Go with CGO","permalink":"/kmdo/docs/cookbook/cgo-and-crosscompiling"}}');var a=i(4848),o=i(8453);const r={},d="Builds: using complex template environment variables",t={},l=[{value:"Using multiple envs",id:"using-multiple-envs",level:2},{value:"Using <code>if</code> statements",id:"using-if-statements",level:2}];function c(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"builds-using-complex-template-environment-variables",children:"Builds: using complex template environment variables"})}),"\n",(0,a.jsx)(e.p,{children:"Builds' environment variables accept templates."}),"\n",(0,a.jsx)(e.p,{children:"You can leverage that to have a single build configuration with different\nenvironment variables for each platform, for example."}),"\n",(0,a.jsxs)(e.p,{children:["A common example of this is the variables ",(0,a.jsx)(e.code,{children:"CC"})," and ",(0,a.jsx)(e.code,{children:"CXX"}),"."]}),"\n",(0,a.jsx)(e.p,{children:"Here are two different examples:"}),"\n",(0,a.jsx)(e.h2,{id:"using-multiple-envs",children:"Using multiple envs"}),"\n",(0,a.jsxs)(e.p,{children:["This example creates once ",(0,a.jsx)(e.code,{children:"CC_"})," and ",(0,a.jsx)(e.code,{children:"CXX_"})," variable for each platform, and then\nset ",(0,a.jsx)(e.code,{children:"CC"})," and ",(0,a.jsx)(e.code,{children:"CXX"})," to the right one:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  - id: mybin\n    binary: mybin\n    main: .\n    goos:\n      - linux\n      - darwin\n      - windows\n    goarch:\n      - amd64\n      - arm64\n    env:\n      - CGO_ENABLED=0\n      - CC_darwin_amd64=o64-clang\n      - CXX_darwin_amd64=o64-clang+\n      - CC_darwin_arm64=aarch64-apple-darwin20.2-clang\n      - CXX_darwin_arm64=aarch64-apple-darwin20.2-clang++\n      - CC_windows_amd64=x86_64-w64-mingw32-gc\n      - CXX_windows_amd64=x86_64-w64-mingw32-g++\n      - \'CC={{ index .Env (print "CC_" .Os "_" .Arch) }}\'\n      - \'CXX={{ index .Env (print "CXX_" .Os "_" .Arch) }}\'\n'})}),"\n",(0,a.jsxs)(e.h2,{id:"using-if-statements",children:["Using ",(0,a.jsx)(e.code,{children:"if"})," statements"]}),"\n",(0,a.jsxs)(e.p,{children:["This example uses ",(0,a.jsx)(e.code,{children:"if"})," statements to set ",(0,a.jsx)(e.code,{children:"CC"})," and ",(0,a.jsx)(e.code,{children:"CXX"}),":"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  - id: mybin\n    binary: mybin\n    main: .\n    goos:\n      - linux\n      - darwin\n      - windows\n    goarch:\n      - amd64\n      - arm64\n    env:\n      - CGO_ENABLED=0\n      - >-\n        {{- if eq .Os "darwin" }}\n          {{- if eq .Arch "amd64"}}CC=o64-clang{{- end }}\n          {{- if eq .Arch "arm64"}}CC=aarch64-apple-darwin20.2-clang{{- end }}\n        {{- end }}\n        {{- if eq .Os "windows" }}\n          {{- if eq .Arch "amd64" }}CC=x86_64-w64-mingw32-gcc{{- end }}\n        {{- end }}\n      - >-\n        {{- if eq .Os "darwin" }}\n          {{- if eq .Arch "amd64"}}CXX=o64-clang+{{- end }}\n          {{- if eq .Arch "arm64"}}CXX=aarch64-apple-darwin20.2-clang++{{- end }}\n        {{- end }}\n        {{- if eq .Os "windows" }}\n          {{- if eq .Arch "amd64" }}CXX=x86_64-w64-mingw32-g++{{- end }}\n        {{- end }}\n'})})]})}function m(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>d});var s=i(6540);const a={},o=s.createContext(a);function r(n){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:r(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);
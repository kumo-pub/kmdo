"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[6863],{7161:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>s,metadata:()=>n,toc:()=>m});const n=JSON.parse('{"id":"cookbook/multi-platform-docker-images","title":"Multi-platform Docker images","description":"On Kmdo there are two main ways of doing that: the easier one is to use","source":"@site/docs/cookbook/multi-platform-docker-images.mdx","sourceDirName":"cookbook","slug":"/cookbook/multi-platform-docker-images","permalink":"/docs/cookbook/multi-platform-docker-images","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"cookBookSidebar","previous":{"title":"Cookbooks","permalink":"/docs/cookbook/"},"next":{"title":"Publish to Nexus","permalink":"/docs/cookbook/publish-to-nexus"}}');var i=o(4848),r=o(8453);const s={},a="Multi-platform Docker images",l={},m=[{value:"Creating Multi-platform docker images with Kmdo",id:"creating-multi-platform-docker-images-with-kmdo",level:2},{value:"Other things to pay attention to",id:"other-things-to-pay-attention-to",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"multi-platform-docker-images",children:"Multi-platform Docker images"})}),"\n",(0,i.jsxs)(t.p,{children:["On Kmdo there are two main ways of doing that: the easier one is to use\nthe ",(0,i.jsx)(t.a,{href:"/docs/tutorial/pub/archive/ko",children:"ko integration"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"If you don't want to, or can't, use Ko for whatever reason, this guide is for\nyou!"}),"\n",(0,i.jsx)(t.h2,{id:"creating-multi-platform-docker-images-with-kmdo",children:"Creating Multi-platform docker images with Kmdo"}),"\n",(0,i.jsx)(t.p,{children:"Kmdo splits the build and publish phase, which makes its usage less\nobvious."}),"\n",(0,i.jsxs)(t.p,{children:["First, you need to define one ",(0,i.jsx)(t.code,{children:"dockers"})," item for each platform you want to\nbuild. Usually, you would tag it like ",(0,i.jsx)(t.code,{children:"myorg/myimage:version-platform"}),".\nIt is also important to use ",(0,i.jsx)(t.code,{children:"buildx"}),". Here's an example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'dockers:\n  - image_templates:\n      - "myorg/myuser:{{ .Tag }}-amd64"\n    use: buildx\n    build_flag_templates:\n      - "--pull"\n      - "--platform=linux/amd64"\n  - image_templates:\n      - "myorg/myuser:{{ .Tag }}-arm64"\n    use: buildx\n    build_flag_templates:\n      - "--pull"\n      - "--platform=linux/arm64"\n    goarch: arm64\n'})}),"\n",(0,i.jsxs)(t.p,{children:["This will, on build time, create two Docker images (",(0,i.jsx)(t.code,{children:"myorg/myuser:v1.2.3-amd64"}),"\nand ",(0,i.jsx)(t.code,{children:"myorg/myuser:v1.2.3-arm64"}),")."]}),"\n",(0,i.jsxs)(t.p,{children:["Now, if we want to make them both available as a single image\n(",(0,i.jsx)(t.code,{children:"myorg/myuser:v1.2.3"}),"), we'll need to add a manifest configuration that will\npublish them behind that single name. Here's how it would look like:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'docker_manifests:\n  - name_template: "myorg/myuser:{{ .Tag }}"\n    image_templates:\n      - "myorg/myuser:{{ .Tag }}-amd64"\n      - "myorg/myuser:{{ .Tag }}-arm64"\n'})}),"\n",(0,i.jsx)(t.p,{children:"And that is it!"}),"\n",(0,i.jsx)(t.h2,{id:"other-things-to-pay-attention-to",children:"Other things to pay attention to"}),"\n",(0,i.jsxs)(t.p,{children:["For ",(0,i.jsx)(t.code,{children:"buildx"})," to work properly, you'll need to install ",(0,i.jsx)(t.code,{children:"qemu"}),". On GitHub actions,\nthe easiest way is to use\n",(0,i.jsx)(t.a,{href:"https://github.com/docker/setup-qemu-action",children:"docker/setup-qemu-action"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["It's also important that the ",(0,i.jsx)(t.code,{children:"FROM"})," in your ",(0,i.jsx)(t.code,{children:"Dockerfile"})," is multi-platform,\notherwise it'll not work."]}),"\n",(0,i.jsx)(t.p,{children:"As long as you have Qemu and Docker set up, everything should just work."})]})}function c(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>a});var n=o(6540);const i={},r=n.createContext(i);function s(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);
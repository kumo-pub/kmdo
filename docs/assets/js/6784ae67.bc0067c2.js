"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4557],{2536:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"tutorial/pub/publish/scm/gitlab","title":"GitLab","description":"API Token","source":"@site/docs/tutorial/pub/publish/scm/gitlab.mdx","sourceDirName":"tutorial/pub/publish/scm","slug":"/tutorial/pub/publish/scm/gitlab","permalink":"/kmdo/docs/tutorial/pub/publish/scm/gitlab","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"GitHub","permalink":"/kmdo/docs/tutorial/pub/publish/scm/github"},"next":{"title":"Scoop Manifests","permalink":"/kmdo/docs/tutorial/pub/publish/scoop"}}');var s=i(4848),a=i(8453);const r={},o="GitLab",c={},l=[{value:"API Token",id:"api-token",level:2},{value:"GitLab Enterprise or private hosted",id:"gitlab-enterprise-or-private-hosted",level:2},{value:"Generic Package Registry",id:"generic-package-registry",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"gitlab",children:"GitLab"})}),"\n",(0,s.jsx)(t.h2,{id:"api-token",children:"API Token"}),"\n",(0,s.jsxs)(t.p,{children:["Kmdo requires an API token with the ",(0,s.jsx)(t.code,{children:"api"})," scope selected to deploy the artifacts to GitLab.\nThat token can either be a Personal, or a Project one."]}),"\n",(0,s.jsxs)(t.p,{children:["This token should be added to the environment variables as ",(0,s.jsx)(t.code,{children:"GITLAB_TOKEN"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Alternatively, you can provide the GitLab token in a file.\nKmdo will check ",(0,s.jsx)(t.code,{children:"~/.config/kmdo/gitlab_token"})," by default, but you can change that in the ",(0,s.jsx)(t.code,{children:".kmdopkg.yaml"})," file:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"env_files:\n  gitlab_token: ~/.path/to/my/gitlab_token\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsxs)(t.p,{children:["If you use a project access token, make sure to set ",(0,s.jsx)(t.code,{children:"use_package_registry"}),"\nto ",(0,s.jsx)(t.code,{children:"true"})," as well, otherwise it might not work."]})}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsxs)(t.p,{children:["If you are using a ",(0,s.jsx)(t.a,{href:"https://docs.gitlab.com/ee/ci/variables/#protected-cicd-variables",children:"protected variable"}),"\nto store any of the values needed by kmdo, ensure that you are protecting the tags as CI jobs in\nGitlab only may access protected variables if the job is run for protected refs\n(",(0,s.jsx)(t.a,{href:"https://docs.gitlab.com/ee/user/project/protected_branches.html",children:"branches"}),",\n",(0,s.jsx)(t.a,{href:"https://docs.gitlab.com/ee/user/project/protected_tags.html",children:"tags"}),")."]})}),"\n",(0,s.jsx)(t.h2,{id:"gitlab-enterprise-or-private-hosted",children:"GitLab Enterprise or private hosted"}),"\n",(0,s.jsxs)(t.p,{children:["You can use Kmdo with GitLab Enterprise by providing its URLs in the\n",(0,s.jsx)(t.code,{children:".kmdopkg.yml"})," configuration file. This takes a normal string, or a template value."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"gitlab_urls:\n  api: https://gitlab.mycompany.com/api/v4/\n  download: https://gitlab.company.com\n\n  # set to true if you use a self-signed certificate\n  skip_tls_verify: false\n\n  # set to true if you want to upload to the Package Registry rather than attachments\n  # Only works with GitLab 13.5+\n  use_package_registry: false\n\n  # Set this if you set GITLAB_TOKEN to the value of CI_JOB_TOKEN.\n  use_job_token: true\n"})}),"\n",(0,s.jsx)(t.p,{children:"If none are set, they default to GitLab's public URLs."}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["Releasing to a private-hosted GitLab CE will only work for version ",(0,s.jsx)(t.code,{children:"v12.9+"}),", due to dependencies\non ",(0,s.jsx)(t.a,{href:"https://docs.gitlab.com/ee/user/project/releases/index.html",children:"release"})," functionality\nand ",(0,s.jsx)(t.a,{href:"https://docs.gitlab.com/ee/user/project/releases/index.html#permanent-links-to-release-assets",children:"direct asset linking"}),"."]})}),"\n",(0,s.jsx)(t.h2,{id:"generic-package-registry",children:"Generic Package Registry"}),"\n",(0,s.jsxs)(t.p,{children:["GitLab introduced the ",(0,s.jsx)(t.a,{href:"https://docs.gitlab.com/ee/user/packages/package_registry/index.html",children:"Generic Package Registry"})," in Gitlab 13.5."]}),"\n",(0,s.jsxs)(t.p,{children:["Normally, ",(0,s.jsx)(t.code,{children:"kmdo"}),' uploads release files as "attachments", which may have ',(0,s.jsx)(t.a,{href:"https://docs.gitlab.com/ee/administration/settings/account_and_limit_settings.html",children:"administrative limits"}),".\nNotably, hosted GitLab instances have a 10MB attachment limit, which cannot be changed."]}),"\n",(0,s.jsxs)(t.p,{children:["Uploading to the Generic Package Registry does not have this restriction.\nTo use it instead, set ",(0,s.jsx)(t.code,{children:"use_package_registry"})," to ",(0,s.jsx)(t.code,{children:"true"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"gitlab_urls:\n  use_package_registry: true\n"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>o});var n=i(6540);const s={},a=n.createContext(s);function r(e){const t=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);
"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2909],{8159:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tutorial/pub/sign/binary_sign","title":"Signing Binaries","description":"This can be used to archive the binaries with their signatures, instead of","source":"@site/docs/tutorial/pub/sign/binary_sign.mdx","sourceDirName":"tutorial/pub/sign","slug":"/tutorial/pub/sign/binary_sign","permalink":"/docs/tutorial/pub/sign/binary_sign","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Signing archives, packages, checksums","permalink":"/docs/tutorial/pub/sign/"},"next":{"title":"Signing Docker Images and Manifests","permalink":"/docs/tutorial/pub/sign/docker_sign"}}');var s=i(4848),a=i(8453);const r={},o="Signing Binaries",l={},c=[{value:"Available variable names",id:"available-variable-names",level:3},{value:"Differences from the default <code>signs</code>",id:"differences-from-the-default-signs",level:3},{value:"Signing with cosign",id:"signing-with-cosign",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"signing-binaries",children:"Signing Binaries"})}),"\n",(0,s.jsx)(n.p,{children:"This can be used to archive the binaries with their signatures, instead of\nsigning the whole archive."}),"\n",(0,s.jsxs)(n.p,{children:["The default is configured to create a detached signature for the checksum files\nwith ",(0,s.jsx)(n.a,{href:"https://www.gnupg.org/",children:"GnuPG"}),", and your default key."]}),"\n",(0,s.jsx)(n.p,{children:"To enable binary signing just add this to your configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"binary_signs:\n  - {}\n"})}),"\n",(0,s.jsx)(n.p,{children:"To customize the binary signing pipeline you can use the following options:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'binary_signs:\n  - #\n    # ID of the sign config, must be unique.\n    #\n    # Default: \'default\'.\n    id: foo\n\n    # Name of the signature file.\n    #\n    # Default: \'${artifact}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}\'.\n    # Templates: allowed.\n    signature: "${artifact}_sig"\n\n    # Path to the signature command\n    #\n    # Default: \'gpg\'.\n    cmd: gpg2\n\n    # Command line arguments for the command\n    #\n    # to sign with a specific key use\n    # args: ["-u", "<key id, fingerprint, email, ...>", "--output", "${signature}", "--detach-sign", "${artifact}"]\n    #\n    # Default: ["--output", "${signature}", "--detach-sign", "${artifact}"].\n    # Templates: allowed.\n    args: ["--output", "${signature}", "${artifact}", "{{ .ProjectName }}"]\n\n    # Which artifacts to sign\n    #\n    # Valid options are:\n    # - none        no signing\n    # - binary:     the binaries\n    #\n    # Default: \'binary\'.\n    artifacts: binary\n\n    # IDs of the artifacts to sign.\n    #\n    # If `artifacts` is checksum or source, this fields has no effect.\n    ids:\n      - foo\n      - bar\n\n\n    # Stdin data to be given to the signature command as stdin.\n    #\n    # Templates: allowed.\n    stdin: "{{ .Env.GPG_PASSWORD }}"\n\n    # StdinFile file to be given to the signature command as stdin.\n    stdin_file: ./.password\n\n    # Sets a certificate that your signing command should write to.\n    #\n    # You can later use `${certificate}` or `.Env.certificate` in the `args` section.\n    #\n    # This is particularly useful for keyless signing with cosign, and should\n    # not usually be used otherwise.\n    #\n    # Note that this should be a name, not a path.\n    #\n    # Templates: allowed.\n    certificate: \'{{ trimsuffix .Env.artifact ".tar.gz" }}.pem\'\n\n    # List of environment variables that will be passed to the signing command\n    # as well as the templates.\n    env:\n      - FOO=bar\n      - HONK=honkhonk\n\n    # By default, the stdout and stderr of the signing cmd are discarded unless\n    # Kmdo is running with `--verbose` set.\n    # You can set this to true if you want them to be displayed regardless.\n    output: true\n'})}),"\n",(0,s.jsx)(n.h3,{id:"available-variable-names",children:"Available variable names"}),"\n",(0,s.jsx)(n.p,{children:"These environment variables might be available in the fields that accept\ntemplates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${artifact}"}),": the path to the artifact that will be signed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${artifactID}"}),": the ID of the artifact that will be signed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${certificate}"}),": the certificate filename, if provided"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"${signature}"}),": the signature filename"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"differences-from-the-default-signs",children:["Differences from the default ",(0,s.jsx)(n.code,{children:"signs"})]}),"\n",(0,s.jsx)(n.p,{children:"The only difference is the artifact filtering and that this pipe also runs in\nthe build phase."}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"signs"}),", if you set ",(0,s.jsx)(n.code,{children:"artifacts"})," to ",(0,s.jsx)(n.code,{children:"binary"}),", it'll only work if you also set\n",(0,s.jsx)(n.code,{children:"archives"})," ",(0,s.jsx)(n.code,{children:"format"})," to ",(0,s.jsx)(n.code,{children:"binary"}),".\nHere, it'll work anyway."]}),"\n",(0,s.jsx)(n.h2,{id:"signing-with-cosign",children:"Signing with cosign"}),"\n",(0,s.jsxs)(n.p,{children:["You can sign your artifacts with ",(0,s.jsx)(n.a,{href:"https://github.com/sigstore/cosign",children:"cosign"})," as well."]}),"\n",(0,s.jsxs)(n.p,{children:["Assuming you have a ",(0,s.jsx)(n.code,{children:"cosign.key"})," in the repository root and a ",(0,s.jsx)(n.code,{children:"COSIGN_PWD"}),"\nenvironment variable set, a simple usage example would look like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'binary_signs:\n  - cmd: cosign\n    stdin: "{{ .Env.COSIGN_PWD }}"\n    args:\n      - "sign-blob"\n      - "--key=cosign.key"\n      - "--output-signature=${signature}"\n      - "${artifact}"\n      - "--yes" # needed on cosign 2.0.0+\n'})}),"\n",(0,s.jsx)(n.p,{children:"Your users can then verify the signature with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"cosign verify-blob -key cosign.pub -signature binary.sig binary\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var t=i(6540);const s={},a=t.createContext(s);function r(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);
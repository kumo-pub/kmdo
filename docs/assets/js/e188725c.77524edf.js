"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[6550],{6984:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"tutorial/pub/publish/upload","title":"HTTP Upload","description":"Kmdo supports building and pushing artifacts to HTTP servers using simple","source":"@site/docs/tutorial/pub/publish/upload.mdx","sourceDirName":"tutorial/pub/publish","slug":"/tutorial/pub/publish/upload","permalink":"/kmdo/docs/tutorial/pub/publish/upload","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Snapshots","permalink":"/kmdo/docs/tutorial/pub/publish/snapshots"},"next":{"title":"Winget","permalink":"/kmdo/docs/tutorial/pub/publish/winget"}}');var a=t(4848),o=t(8453);const s={},r="HTTP Upload",l={},c=[{value:"How it works",id:"how-it-works",level:2},{value:"Target",id:"target",level:3},{value:"Username",id:"username",level:3},{value:"Password",id:"password",level:3},{value:"Client authorization with x509 certificate (mTLS / mutual TLS)",id:"client-authorization-with-x509-certificate-mtls--mutual-tls",level:3},{value:"Server authentication",id:"server-authentication",level:3},{value:"Customization",id:"customization",level:2}];function d(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"http-upload",children:"HTTP Upload"})}),"\n",(0,a.jsx)(n.p,{children:"Kmdo supports building and pushing artifacts to HTTP servers using simple\nHTTP requests."}),"\n",(0,a.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,a.jsxs)(n.p,{children:["You can declare multiple ",(0,a.jsx)(n.code,{children:"uploads"})," instances. All binaries generated by your\n",(0,a.jsx)(n.code,{children:"builds"})," section will be pushed to each configured upload."]}),"\n",(0,a.jsxs)(n.p,{children:["If you have only one ",(0,a.jsx)(n.code,{children:"uploads"})," instance, the configuration is as easy as adding\nthe upload target and a name to your ",(0,a.jsx)(n.code,{children:".kmdopkg.yaml"})," file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"uploads:\n  - name: production\n    target: http://some.server/some/path/example-repo-local/{{ .ProjectName }}/{{ .Version }}/\n"})}),"\n",(0,a.jsx)(n.p,{children:"Prerequisites:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"An HTTP server accepting HTTP requests"}),"\n",(0,a.jsx)(n.li,{children:"A user + password / client x509 certificate / API key with grants to upload an artifact"}),"\n"]}),"\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.p,{children:"authentication is optional and may be provided if the server requires it"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"user/pass is for Basic Authentication"}),"\n",(0,a.jsx)(n.li,{children:'client x509 certificate is for mutual TLS authentication (aka "mTLS")'}),"\n"]})]}),"\n",(0,a.jsx)(n.h3,{id:"target",children:"Target"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"target"})," is the template of the URL to upload the artifacts to (",(0,a.jsx)(n.em,{children:"without"})," the name of the artifact)."]}),"\n",(0,a.jsxs)(n.p,{children:["An example configuration for ",(0,a.jsx)(n.code,{children:"kmdo"})," in upload mode ",(0,a.jsx)(n.code,{children:"binary"})," with the target can look like:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'- name: production\n  mode: binary\n  target: "http://some.server/some/path/example-repo-local/{{ .ProjectName }}/{{ .Version }}/{{ .Os }}/{{ .Arch }}{{ if .Arm }}{{ .Arm }}{{ end }}"\n'})}),"\n",(0,a.jsxs)(n.p,{children:["And will result in an HTTP PUT request sent to\n",(0,a.jsx)(n.code,{children:"http://some.server/some/path/example-repo-local/kumose/1.0.0/Darwin/x86_64/kmdo"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Supported variables:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"Version"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"Tag"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"ProjectName"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"ArtifactName"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"Os"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"Arch"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"Arm"})}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsxs)(n.p,{children:["Variables ",(0,a.jsx)(n.code,{children:"Os"}),", ",(0,a.jsx)(n.code,{children:"Arch"})," and ",(0,a.jsx)(n.code,{children:"Arm"})," are only supported in upload mode ",(0,a.jsx)(n.code,{children:"binary"}),"."]})}),"\n",(0,a.jsxs)(n.p,{children:["For ",(0,a.jsx)(n.code,{children:"archive"})," mode, it will also included the ",(0,a.jsx)(n.code,{children:"LinuxPackage"})," type which is\ngenerated by ",(0,a.jsx)(n.code,{children:"nfpm"})," and the like."]}),"\n",(0,a.jsx)(n.h3,{id:"username",children:"Username"}),"\n",(0,a.jsx)(n.p,{children:"Your configured username needs to be valid against your HTTP server."}),"\n",(0,a.jsxs)(n.p,{children:["You can have the username set in the configuration file as shown above\nor you can have it read from an environment variable.\nThe configured name of your HTTP server will be used to build the environment\nvariable name.\nThis way we support auth for multiple instances.\nThis also means that the ",(0,a.jsx)(n.code,{children:"name"})," per configured instance needs to be unique\nper Kmdo configuration."]}),"\n",(0,a.jsxs)(n.p,{children:["The name of the environment variable will be ",(0,a.jsx)(n.code,{children:"UPLOAD_NAME_USERNAME"}),".\nIf your instance is named ",(0,a.jsx)(n.code,{children:"production"}),", you can store the username in the\nenvironment variable ",(0,a.jsx)(n.code,{children:"UPLOAD_PRODUCTION_USERNAME"}),".\nThe name will be transformed to uppercase."]}),"\n",(0,a.jsx)(n.p,{children:"If a configured username is found in the configuration file, then the\nenvironment variable is not used at all."}),"\n",(0,a.jsx)(n.p,{children:"This field is optional and is used only for basic http authentication."}),"\n",(0,a.jsx)(n.h3,{id:"password",children:"Password"}),"\n",(0,a.jsxs)(n.p,{children:["The password will be stored in an environment variable.\nThe configured name of your HTTP server will be used.\nThis way we support auth for multiple instances.\nThis also means that the ",(0,a.jsx)(n.code,{children:"name"})," per configured instance needs to be unique\nper Kmdo configuration."]}),"\n",(0,a.jsxs)(n.p,{children:["The name of the environment variable will be ",(0,a.jsx)(n.code,{children:"UPLOAD_NAME_SECRET"}),".\nIf your instance is named ",(0,a.jsx)(n.code,{children:"production"}),", you need to store the secret in the\nenvironment variable ",(0,a.jsx)(n.code,{children:"UPLOAD_PRODUCTION_SECRET"}),".\nThe name will be transformed to uppercase."]}),"\n",(0,a.jsx)(n.p,{children:"This field is optional and is used only for basic http authentication."}),"\n",(0,a.jsx)(n.h3,{id:"client-authorization-with-x509-certificate-mtls--mutual-tls",children:"Client authorization with x509 certificate (mTLS / mutual TLS)"}),"\n",(0,a.jsx)(n.p,{children:"If your artifactory server supports authorization with mTLS (client\ncertificates), you can provide them by specifying the location of an x509\ncertificate/key pair of pem-encode files."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'uploads:\n  - name: production\n    client_x509_cert: path/to/client.cert.pem\n    client_x509_key: path/to/client.key.pem\n    target: "http://some.server/some/path/example-repo-local/{{ .ProjectName }}/{{ .Version }}/{{ .Os }}/{{ .Arch }}{{ if .Arm }}{{ .Arm }}{{ end }}"\n'})}),"\n",(0,a.jsx)(n.p,{children:"This will offer the client certificate during the TLS handshake, which your artifactory server may use to authenticate\nand authorize you to upload."}),"\n",(0,a.jsx)(n.h3,{id:"server-authentication",children:"Server authentication"}),"\n",(0,a.jsx)(n.p,{children:"You can authenticate your TLS server adding a trusted X.509 certificate chain in\nyour upload configuration."}),"\n",(0,a.jsx)(n.p,{children:"The trusted certificate chain will be used to validate the server certificates."}),"\n",(0,a.jsxs)(n.p,{children:["You can set the trusted certificate chain using the ",(0,a.jsx)(n.code,{children:"trusted_certificates"}),"\nsetting the upload section with PEM encoded certificates on a YAML literal block\nlike this:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'uploads:\n  - name: "some HTTP/TLS server"\n    #...(other settings)...\n    trusted_certificates: |\n      -----BEGIN CERTIFICATE-----\n      MIIDrjCCApagAwIBAgIIShr2zchZo+8wDQYJKoZIhvcNAQENBQAwNTEXMBUGA1UE\n      ...(edited content)...\n      TyzMJasj5BPZrmKjJb6O/tOtEIJ66xPSBTxPShkEYHnB7A==\n      -----END CERTIFICATE-----\n      -----BEGIN CERTIFICATE-----\n      MIIDrjCCApagAwIBAgIIShr2zchZo+8wDQYJKoZIhvcNAQENBQAwNTEXMBUGA1UE\n      ...(edited content)...\n      TyzMJasj5BPZrmKjJb6O/tOtEIJ66xPSBTxPShkEYHnB7A==\n      -----END CERTIFICATE-----\n'})}),"\n",(0,a.jsx)(n.h2,{id:"customization",children:"Customization"}),"\n",(0,a.jsx)(n.p,{children:"Of course, you can customize a lot of things:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"uploads:\n  # You can have multiple upload instances.\n  - # Unique name of your upload instance. Used to identify the instance.\n    name: production\n\n    # HTTP method to use.\n    #\n    # Default: 'PUT'.\n    method: POST\n\n    # IDs of the artifacts you want to upload.\n    ids:\n      - foo\n      - bar\n\n    # File extensions to filter for.\n    # This might be useful if you have multiple packages with different\n    # extensions with the same ID, and need to upload each extension to\n    # a different place (e.g. nFPM packages).\n    exts:\n      - deb\n      - rpm\n\n\n    # Upload mode. Valid options are `binary` and `archive`.\n    #\n    # If mode is `archive`, variables _Os_, _Arch_ and _Arm_ for target name\n    #   are not supported. In that case these variables are empty.\n    #\n    # If mode is `binary`, you'll need to have the archives section setup with\n    #   format \"binary\" as well.\n    #\n    # Default: 'archive'.\n    mode: archive\n\n    # URL to be used as target of the HTTP request\n    #\n    # Templates: allowed.\n    target: https://some.server/some/path/example-repo-local/{{ .ProjectName }}/{{ .Version }}/\n\n    # Custom artifact name.\n    # If enable, you must supply the name of the Artifact as part of the Target\n    # URL as it will not be automatically append to the end of the URL, its\n    # pre-computed name is available as _ArtifactName_ for example\n    # target: https://some.server/some/path/example-repo-local/{{ .ArtifactName }};deb.distribution=xenial\n    custom_artifact_name: true\n\n    # An optional username that will be used for the deployment for basic auth.\n    #\n    # Templates: allowed (since v2.12).\n    username: deployuser\n\n    # An optional password that will be used for the deployment for basic auth.\n    #\n    # Templates: allowed.\n    password: '{{ readFile \"~/.config/foo\" }}'\n\n    # Client certificate and key (when provided, added as client cert to TLS connections)\n    client_x509_cert: /path/to/client.cert.pem\n    client_x509_key: /path/to/client.key.pem\n\n    # An optional header you can use to tell Kmdo to pass the artifact's\n    # SHA256 checksum within the upload request.\n    checksum_header: -X-SHA256-Sum\n\n    # A map of custom headers e.g. to support required content types or auth schemes.\n    custom_headers:\n      JOB-TOKEN: \"{{ .Env.CI_JOB_TOKEN }}\"\n\n    # Upload checksums.\n    checksum: true\n\n    # Upload metadata.json and artifacts.json.\n    meta: true\n\n    # Upload signatures.\n    signature: true\n\n    # Skip this upload configuration.\n    #\n    # Templates: allowed.\n    skip: \"{{gt .Patch 0}}\"\n\n    # Certificate chain used to validate server certificates\n    trusted_certificates: |\n      -----BEGIN CERTIFICATE-----\n      MIIDrjCCApagAwIBAgIIShr2zchZo+8wDQYJKoZIhvcNAQENBQAwNTEXMBUGA1UE\n      ...(edited content)...\n      TyzMJasj5BPZrmKjJb6O/tOtEIJ66xPSBTxPShkEYHnB7A==\n      -----END CERTIFICATE-----\n\n    # You can add extra pre-existing files to the upload.\n    #\n    # The filename on the release will be the last part of the path (base).\n    # If another file with the same name exists, the last one found will be used.\n    # These globs can also include templates.\n    #\n    extra_files:\n      - glob: ./path/to/file.txt\n      - glob: ./docs/*.md\n      - glob: ./glob/**/to/**/file/**/*\n      - glob: ./glob/foo/to/bar/file/foobar/override_from_previous\n      - glob: ./single_file.txt\n        # Templates: allowed.\n        # Note that this only works if glob matches exactly 1 file.\n        name_template: file.txt\n\n\n    # Upload only the files defined in extra_files.\n    extra_files_only: true\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var i=t(6540);const a={},o=i.createContext(a);function s(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);
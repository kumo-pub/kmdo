"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2232],{2825:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tutorial/pub/archive/ko","title":"Docker Images with Ko","description":"You can also use ko to build and publish Docker container images.","source":"@site/docs/tutorial/pub/archive/ko.mdx","sourceDirName":"tutorial/pub/archive","slug":"/tutorial/pub/archive/ko","permalink":"/kmdo/docs/tutorial/pub/archive/ko","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Docker (v2)","permalink":"/kmdo/docs/tutorial/pub/archive/dockers_v2"},"next":{"title":"Self-Extracting Archives","permalink":"/kmdo/docs/tutorial/pub/archive/makeself"}}');var o=t(4848),a=t(8453);const s={},r="Docker Images with Ko",l={},d=[{value:"Example",id:"example",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"docker-images-with-ko",children:"Docker Images with Ko"})}),"\n",(0,o.jsxs)(n.p,{children:["You can also use ",(0,o.jsx)(n.a,{href:"https://ko.build",children:"ko"})," to build and publish Docker container images."]}),"\n",(0,o.jsxs)(n.p,{children:["Please notice that ko will build your binary again.\nThat shouldn't increase the release times too much, as it'll use the same build\noptions as the ",(0,o.jsx)(n.a,{href:"/kmdo/docs/tutorial/pub/builds/go",children:"build"})," pipe when possible, so the results will probably be\ncached."]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["When on ",(0,o.jsx)(n.code,{children:"--snapshot"})," mode, Ko will publish the image to ",(0,o.jsx)(n.code,{children:"ko.local"}),".\nIf its a regular build, Ko will only run in the publishing phase."]})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["For Ko to work you still need to login, either with ",(0,o.jsx)(n.code,{children:"docker login"})," or\nsomething else."]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'kos:\n  - # ID of this image.\n    id: foo\n\n    # Build ID that should be used to import the build settings.\n    build: build-id\n\n    # Main path to build.\n    # It must be a relative path\n    #\n    # Default: build.main.\n    main: ./cmd/...\n\n    # Working directory used to build.\n    #\n    # Default: build.dir.\n    working_dir: .\n\n    # Base image to publish to use.\n    #\n    # Default: \'cgr.dev/chainguard/static\'.\n    base_image: alpine\n\n    # Labels for the image.\n    labels:\n      foo: bar\n\n    # Annotations for the OCI manifest.\n    annotations:\n      foo: bar\n\n    # The default user the image should be run as.\n    user: "1234:1234"\n\n    # Repositories to push to.\n    #\n    # First one will be used on Ko build, the other ones will be copied from the\n    # first one using crane.\n    #\n    # Default: [ \'$KO_DOCKER_REPO\' ].\n    repositories:\n      - ghcr.io/foo/bar\n      - foo/bar\n\n    # Repository to push to.\n    #\n    # Default: \'$KO_DOCKER_REPO\'.\n    # Deprecated: use \'repositories\' instead.\n    repository: ghcr.io/foo/bar\n\n    # Platforms to build and publish.\n    #\n    # Default: \'linux/amd64\'.\n    platforms:\n      - linux/amd64\n      - linux/arm64\n\n    # Tag to build and push.\n    # Empty tags are ignored.\n    #\n    # Default: \'latest\'.\n    # Templates: allowed.\n    tags:\n      - latest\n      - "{{.Tag}}"\n      - "{{if not .Prerelease}}stable{{end}}"\n\n    # Creation time given to the image\n    # in seconds since the Unix epoch as a string.\n    #\n    # Templates: allowed.\n    creation_time: "{{.CommitTimestamp}}"\n\n    # Creation time given to the files in the kodata directory\n    # in seconds since the Unix epoch as a string.\n    #\n    # Templates: allowed.\n    ko_data_creation_time: "{{.CommitTimestamp}}"\n\n    # SBOM format to use.\n    #\n    # Default: \'spdx\'.\n    # Valid options are: spdx and none.\n    sbom: none\n\n    # Path to file where the SBOM will be written\n    #\n    # Default: unset - no SBOM written to filesystem (but still uploaded to oci repository).\n    sbom_directory: "out/sbom"\n\n    # Ko publishes images to the local Docker daemon\n    # when Kmdo is executed with the --snapshot flag.\n    # Use the local_domain attribute to configure the local registry (e.g. kind.local).\n    #\n    # Default "kmdo.ko.local" - local docker registry is used.\n    local_domain: "kmdo.ko.local"\n\n    # Ldflags to use on build.\n    #\n    # Default: build.ldflags.\n    ldflags:\n      - foo\n      - bar\n\n    # Flags to use on build.\n    #\n    # Default: build.flags.\n    flags:\n      - foo\n      - bar\n\n    # Env to use on build.\n    #\n    # Default: build.env.\n    env:\n      - FOO=bar\n      - SOMETHING=value\n\n    # Whether to disable this particular Ko configuration.\n    #\n    # Templates: allowed.\n    disable: "{{ .IsSnapshot }}"\n\n    # Bare uses a tag on the $KO_DOCKER_REPO without anything additional.\n    bare: true\n\n    # Whether to preserve the full import path after the repository name.\n    preserve_import_paths: true\n\n    # Whether to use the base path without the MD5 hash after the repository name.\n    base_import_paths: true\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Refer to ",(0,o.jsx)(n.a,{href:"https://ko.build",children:"ko's project page"})," for more information."]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["Note that while Kmdo's build section will evaluate environment\nvariables for each target being built, Ko doesn't.\nThis means that variables like ",(0,o.jsx)(n.code,{children:".Os"}),", ",(0,o.jsx)(n.code,{children:".Arch"}),", and the sorts, will not be\navailable."]})}),"\n",(0,o.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,o.jsx)(n.p,{children:"Here's a minimal example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'before:\n  hooks:\n    - go mod tidy\n\nbuilds:\n  - env: ["CGO_ENABLED=1"]\n    binary: test\n    goos:\n      - darwin\n      - linux\n    goarch:\n      - amd64\n      - arm64\n\nkos:\n  - repositories: [ghcr.io/caarlos0/test-ko]\n    tags:\n      - "{{.Version}}"\n      - latest\n    bare: true\n    preserve_import_paths: false\n    platforms:\n      - linux/amd64\n      - linux/arm64\n'})}),"\n",(0,o.jsxs)(n.p,{children:["This will build the binaries for ",(0,o.jsx)(n.code,{children:"linux/arm64"}),", ",(0,o.jsx)(n.code,{children:"linux/amd64"}),", ",(0,o.jsx)(n.code,{children:"darwin/amd64"}),"\nand ",(0,o.jsx)(n.code,{children:"darwin/arm64"}),", as well as the Docker images and manifest for Linux."]}),"\n",(0,o.jsx)(n.h1,{id:"signing-ko-manifests",children:"Signing KO manifests"}),"\n",(0,o.jsxs)(n.p,{children:["KO will add the built manifest to the artifact list, so you can sign them with\n",(0,o.jsx)(n.code,{children:"docker_signs"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"docker_signs:\n  - artifacts: manifests\n"})})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var i=t(6540);const o={},a=i.createContext(o);function s(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);
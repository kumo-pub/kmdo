"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[5685],{8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(6540);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}},9922:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"tutorial/pub/archive/nfpm","title":"Linux packages (via nFPM)","description":"Kmdo can be wired to nfpm to","source":"@site/docs/tutorial/pub/archive/nfpm.mdx","sourceDirName":"tutorial/pub/archive","slug":"/tutorial/pub/archive/nfpm","permalink":"/docs/tutorial/pub/archive/nfpm","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Self-Extracting Archives","permalink":"/docs/tutorial/pub/archive/makeself"},"next":{"title":"Snapcraft Packages (snaps)","permalink":"/docs/tutorial/pub/archive/snapcraft"}}');var i=t(4848),s=t(8453);const o={},r="Linux packages (via nFPM)",l={},c=[{value:"Signing key passphrases",id:"signing-key-passphrases",level:2},{value:"A note about Termux",id:"a-note-about-termux",level:2},{value:"Conventional file names, Debian, and ARMv6",id:"conventional-file-names-debian-and-armv6",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"linux-packages-via-nfpm",children:"Linux packages (via nFPM)"})}),"\n",(0,i.jsxs)(n.p,{children:["Kmdo can be wired to ",(0,i.jsx)(n.a,{href:"https://github.com/kumose-go/nfpm",children:"nfpm"})," to\ngenerate and publish ",(0,i.jsx)(n.code,{children:".deb"}),", ",(0,i.jsx)(n.code,{children:".rpm"}),", ",(0,i.jsx)(n.code,{children:".apk"}),", ",(0,i.jsx)(n.code,{children:".ipk"}),", and Archlinux packages."]}),"\n",(0,i.jsx)(n.p,{children:"Available options:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'nfpms:\n  # note that this is an array of nfpm configs\n  - #\n    # ID of the nfpm config, must be unique.\n    #\n    # Default: \'default\'.\n    id: foo\n\n    # Name of the package.\n    #\n    # Default: ProjectName.\n    # Templates: allowed.\n    package_name: foo\n\n    # You can change the file name of the package.\n    #\n    # Default: \'{{ .PackageName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}\'.\n    # Templates: allowed.\n    file_name_template: "{{ .ConventionalFileName }}"\n\n    # IDs of the builds which should be archived in this package.\n    #\n    # Default: empty (include all).\n    ids:\n      - foo\n      - bar\n\n\n    # Your app\'s vendor.\n    vendor: Drum Roll Inc.\n\n    # Your app\'s homepage.\n    #\n    # Default: inferred from global metadata.\n    homepage: https://example.com/\n\n    # Your app\'s maintainer (probably you).\n    #\n    # Default: inferred from global metadata.\n    maintainer: Drummer <drum-roll@example.com>\n\n    # Your app\'s description.\n    #\n    # Default: inferred from global metadata.\n    description: |-\n      Drum rolls installer package.\n      Software to create fast and easy drum rolls.\n\n    # Your app\'s license.\n    #\n    # Default: inferred from global metadata.\n    license: Apache 2.0\n\n    # Formats to be generated.\n    formats:\n      - apk\n      - deb\n      - rpm\n      - termux.deb\n      - archlinux\n\n    # Umask to be used on files without explicit mode set. (overridable)\n    #\n    # Default: 0o002 (will remove world-writable permissions).\n    umask: 0o002\n\n    # Packages your package depends on. (overridable)\n    dependencies:\n      - git\n      - zsh\n\n    # Packages it provides. (overridable)\n    provides:\n      - bar\n\n    # Packages your package recommends installing. (overridable)\n    recommends:\n      - bzr\n      - gtk\n\n    # Packages your package suggests installing. (overridable)\n    suggests:\n      - cvs\n      - ksh\n\n    # Packages that conflict with your package. (overridable)\n    conflicts:\n      - svn\n      - bash\n\n    # Packages it replaces. (overridable)\n    replaces:\n      - fish\n\n    # Path that the binaries should be installed.\n    #\n    # Default: \'/usr/bin\'.\n    bindir: /usr/bin\n\n    # Paths to the directories where to put specific types of libraries that\n    # Kmdo built.\n    #\n    # This should be used together with `builds.buildmode`\n    #\n    # Templates: allowed.\n    libdirs:\n      # Default: \'/usr/include\'.\n      headers: /usr/include/something\n\n      # Default: \'/usr/lib\'.\n      cshared: /usr/lib/foo\n\n      # Default: \'/usr/lib\'.\n      carchive: /usr/lib/foobar\n\n    # Version Epoch.\n    #\n    # Default: extracted from `version` if it is semver compatible.\n    epoch: 2\n\n    # Version Prerelease.\n    #\n    # Default: extracted from `version` if it is semver compatible.\n    prerelease: beta1\n\n    # Version Metadata (previously deb.metadata).\n    # Setting metadata might interfere with version comparisons depending on the\n    # packager.\n    #\n    # Default: extracted from `version` if it is semver compatible.\n    version_metadata: git\n\n    # Version Release.\n    release: 1\n\n    # Section.\n    section: default\n\n    # Priority.\n    priority: extra\n\n    # Makes a meta package - an empty package that contains only supporting\n    # files and dependencies.\n    # When set to `true`, the `builds` option is ignored.\n    meta: true\n\n    # Changelog YAML file, see: https://github.com/kumose-go/chglog\n    #\n    # You can use kumose-go/chglog to create the changelog for your project,\n    # pass that changelog yaml file to Kmdo,\n    # and it should in turn setup it accordingly for the given available\n    # formats (deb and rpm at the moment).\n    #\n    # Experimental.\n    changelog: ./foo.yml\n\n    # Contents to add to the package.\n    # Kmdo will automatically add the binaries.\n    contents:\n      # Basic file that applies to all packagers\n      - src: path/to/foo\n        dst: /usr/bin/foo\n\n      # This will add all files in some/directory or in subdirectories at the\n      # same level under the directory /etc. This means the tree structure in\n      # some/directory will not be replicated.\n      - src: some/directory/\n        dst: /etc\n\n      # This will replicate the directory structure under some/directory at\n      # /etc, using the "tree" type.\n      #\n      # Templates: allowed.\n      - src: some/directory/\n        dst: /etc\n        type: tree\n        file_info:\n          # File mode.\n          mode: 0644\n          # Modification time.\n          #\n          # Templates: allowed (since v2.6).\n          mtime: "{{.CommitDate}}"\n\n          # Owner name.\n          #\n          # Templates: allowed (since v2.6).\n          owner: notRoot\n\n          # Group name.\n          #\n          # Templates: allowed (since v2.6).\n          group: notRoot\n\n      # Simple config file\n      - src: path/to/foo.conf\n        dst: /etc/foo.conf\n        type: config\n\n      # Simple symlink.\n      # Corresponds to `ln -s /sbin/foo /usr/bin/foo`\n      - src: /sbin/foo\n        dst: /usr/bin/foo\n        type: "symlink"\n\n      # Corresponds to `%config(noreplace)` if the packager is rpm, otherwise it\n      # is just a config file\n      - src: path/to/local/bar.conf\n        dst: /etc/bar.conf\n        type: "config|noreplace"\n\n      # The src and dst attributes also supports name templates\n      - src: path/{{ .Os }}-{{ .Arch }}/bar.conf\n        dst: /etc/foo/bar-{{ .ProjectName }}.conf\n\n\n      # These files are not actually present in the package, but the file names\n      # are added to the package header. From the RPM directives documentation:\n      #\n      # "There are times when a file should be owned by the package but not\n      # installed - log files and state files are good examples of cases you\n      # might desire this to happen."\n      #\n      # "The way to achieve this, is to use the %ghost directive. By adding this\n      # directive to the line containing a file, RPM will know about the ghosted\n      # file, but will not add it to the package."\n      #\n      # For non rpm packages ghost files are ignored at this time.\n      - dst: /etc/casper.conf\n        type: ghost\n      - dst: /var/log/boo.log\n        type: ghost\n\n      # You can use the packager field to add files that are unique to a\n      # specific packager\n      - src: path/to/rpm/file.conf\n        dst: /etc/file.conf\n        type: "config|noreplace"\n        packager: rpm\n      - src: path/to/deb/file.conf\n        dst: /etc/file.conf\n        type: "config|noreplace"\n        packager: deb\n      - src: path/to/apk/file.conf\n        dst: /etc/file.conf\n        type: "config|noreplace"\n        packager: apk\n\n      # Sometimes it is important to be able to set the mtime, mode, owner, or\n      # group for a file that differs from what is on the local build system at\n      # build time.\n      - src: path/to/foo\n        dst: /usr/local/foo\n        file_info:\n          # File mode.\n          mode: 0644\n          # Modification time.\n          #\n          # Templates: allowed (since v2.6).\n          mtime: "{{.CommitDate}}"\n\n          # Owner name.\n          #\n          # Templates: allowed (since v2.6).\n          owner: notRoot\n\n          # Group name.\n          #\n          # Templates: allowed (since v2.6).\n          group: notRoot\n\n      # If `dst` ends with a `/`, it\'ll create the given path and copy the given\n      # `src` into it, the same way `cp` works with and without trailing `/`.\n      - src: ./foo/bar/*\n        dst: /usr/local/myapp/\n\n      # Using the type \'dir\', empty directories can be created. When building\n      # RPMs, however, this type has another important purpose: Claiming\n      # ownership of that directory. This is important because when upgrading or\n      # removing an RPM package, only the directories for which it has claimed\n      # ownership are removed. However, you should not claim ownership of a\n      # directory that is created by the OS or a dependency of your package.\n      #\n      # A directory in the build environment can optionally be provided in the\n      # \'src\' field in order copy mtime and mode from that directory without\n      # having to specify it manually.\n      - dst: /some/dir\n        type: dir\n        file_info:\n          mode: 0700\n\n    # Scripts to execute during the installation of the package. (overridable)\n    #\n    # Keys are the possible targets during the installation process\n    # Values are the paths to the scripts which will be executed.\n    #\n    # Templates: allowed.\n    scripts:\n      preinstall: "scripts/preinstall.sh"\n      postinstall: "scripts/postinstall.sh"\n      preremove: "scripts/preremove.sh"\n      postremove: "scripts/postremove.sh"\n\n    # Date to be used as mtime for the package itself, and its internal files.\n    # You may also want to set the mtime on its contents.\n    #\n    # Templates: allowed.\n    mtime: "{{ .CommitDate }}"\n\n    # All fields above marked as `overridable` can be overridden for a given\n    # package format in this section.\n    overrides:\n      # The dependencies override can for example be used to provide version\n      # constraints for dependencies where  different package formats use\n      # different versions or for dependencies that are named differently.\n      deb:\n        dependencies:\n          - baz (>= 1.2.3-0)\n          - some-lib-dev\n        # ...\n      rpm:\n        dependencies:\n          - baz >= 1.2.3-0\n          - some-lib-devel\n        # ...\n      apk:\n        # ...\n\n    # Custom configuration applied only to the RPM packager.\n    rpm:\n      # RPM specific scripts.\n      scripts:\n        # The pretrans script runs before all RPM package transactions / stages.\n        pretrans: ./scripts/pretrans.sh\n        # The posttrans script runs after all RPM package transactions / stages.\n        posttrans: ./scripts/posttrans.sh\n\n      # The package summary.\n      #\n      # Default: first line of the description.\n      summary: Explicit Summary for Sample Package\n\n      # The package group.\n      # This option is deprecated by most distros but required by old distros\n      # like CentOS 5 / EL 5 and earlier.\n      group: Unspecified\n\n      # The packager is used to identify the organization that actually packaged\n      # the software, as opposed to the author of the software.\n      # `maintainer` will be used as fallback if not specified.\n      # This will expand any env var you set in the field, eg packager: ${PACKAGER}\n      packager: Kmdo <staff@kumose.cc>\n\n      # The hostname of the machine the rpm was built with.\n      #\n      # Default: os.Hostname()\n      buildhost: foo.bar\n\n      # Compression algorithm (gzip (default), lzma or xz).\n      compression: lzma\n\n      # Prefixes for relocatable packages.\n      prefixes:\n        - /usr/bin\n\n      # The package is signed if a key_file is set\n      signature:\n        # PGP secret key file path (can also be ASCII-armored).\n        #\n        # See "Signing key passphrases" below for more information.\n        #\n        # Templates: allowed.\n        key_file: "{{ .Env.GPG_KEY_PATH }}"\n\n    # Custom configuration applied only to the Deb packager.\n    deb:\n      # Lintian overrides\n      lintian_overrides:\n        - statically-linked-binary\n        - changelog-file-missing-in-native-package\n\n      # Custom deb special files.\n      scripts:\n        # Deb rules script.\n        rules: foo.sh\n\n        # Deb templates file, when using debconf.\n        templates: templates\n\n      # Custom deb triggers\n      triggers:\n        # register interest on a trigger activated by another package\n        # (also available: interest_await, interest_noawait)\n        interest:\n          - some-trigger-name\n\n        # activate a trigger for another package\n        # (also available: activate_await, activate_noawait)\n        activate:\n          - another-trigger-name\n\n      # Packages which would break if this package would be installed.\n      # The installation of this package is blocked if `some-package`\n      # is already installed.\n      breaks:\n        - some-package\n\n      # The package is signed if a key_file is set\n      signature:\n        # PGP secret key file path (can also be ASCII-armored).\n        #\n        # See "Signing key passphrases" below for more information.\n        #\n        # Templates: allowed.\n        key_file: "{{ .Env.GPG_KEY_PATH }}"\n\n        # The type describes the signers role, possible values are "origin",\n        # "maint" and "archive".\n        #\n        # Default: \'origin\'.\n        type: origin\n\n      # Additional fields for the control file. Empty fields are ignored.\n      # This will expand any env vars you set in the field values, e.g. Vcs-Browser: ${CI_PROJECT_URL}\n      fields:\n        Bugs: https://github.com/kumose-go/nfpm/issues\n\n      # The Debian-specific "predepends" field can be used to ensure the complete installation of a list of\n      # packages (including unpacking, pre- and post installation scripts) prior to the installation of the\n      # built package.\n      predepends:\n        - baz (>= 1.2.3-0)\n\n    apk:\n      # APK specific scripts.\n      scripts:\n        # The preupgrade script runs before APK upgrade.\n        preupgrade: ./scripts/preupgrade.sh\n\n        # The postupgrade script runs after APK.\n        postupgrade: ./scripts/postupgrade.sh\n\n      # The package is signed if a key_file is set\n      signature:\n        # PGP secret key file path (can also be ASCII-armored).\n        #\n        # See "Signing key passphrases" below for more information.\n        #\n        # Templates: allowed.\n        key_file: "{{ .Env.GPG_KEY_PATH }}"\n\n        # The name of the signing key. When verifying a package, the signature\n        # is matched to the public key store in /etc/apk/keys/<key_name>.rsa.pub.\n        #\n        # Default: maintainer\'s email address.\n        # Templates: allowed.\n        key_name: origin\n\n    archlinux:\n      # Archlinux-specific scripts\n      scripts:\n        # The preupgrade script runs before pacman upgrades the package.\n        preupgrade: ./scripts/preupgrade.sh\n\n        # The postupgrade script runs after pacman upgrades the package.\n        postupgrade: ./scripts/postupgrade.sh\n\n      # The pkgbase can be used to explicitly specify the name to be used to refer\n      # to a group of packages. See: https://wiki.archlinux.org/title/PKGBUILD#pkgbase.\n      pkgbase: foo\n\n      # The packager refers to the organization packaging the software, not to be confused\n      # with the maintainer, which is the person who maintains the software.\n      packager: Kmdo <staff@kumose.cc>\n\n    # Custom configuration applied only to the IPK packager.\n    ipk:\n      # The ABI version to specify.\n      #\n      # Default: none\n      abi_version:\n\n      # Alternate names for files created using symlinks\n      #\n      # Default: none\n      alternatives:\n        - #\n          # The IPK priority used when creating the alternative link.\n          priority: 4\n\n          # The target path and file the alternative is linked to.\n          target: /usr/bin/ls\n\n          # The alternative path and file created.\n          link_name: /usr/bin/alternate_ls\n\n      # Mark the package to be auto installed.\n      #\n      # Default: false\n      auto_install: false\n\n      # Mark the package as essential.\n      #\n      # Default: false\n      essential: false\n\n      # Additional fields for the control file. Empty fields are ignored.\n      # This will expand any env vars you set in the field values, e.g. Vcs-Browser: ${CI_PROJECT_URL}\n      #\n      # Default: none\n      fields:\n        Bugs: https://github.com/kumose-go/nfpm/issues\n\n      # The IPK-specific "predepends" field can be used to ensure the complete installation of a list of\n      # packages (including unpacking, pre- and post installation scripts) prior to the installation of the\n      # built package.\n      #\n      # Default: none\n      predepends:\n        - baz\n\n      # A list of tags to associate with the package.\n      #\n      # Default: none\n      tags:\n        - foo\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:'Fields marked with "overridable" can be overridden for any format.'})}),"\n",(0,i.jsx)(n.h2,{id:"signing-key-passphrases",children:"Signing key passphrases"}),"\n",(0,i.jsx)(n.p,{children:"Kmdo will try to get the password from the following environment\nvariables, in the following order of preference:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"$NFPM_[ID]_[FORMAT]_PASSPHRASE"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"$NFPM_[ID]_PASSPHRASE"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"$NFPM_PASSPHRASE"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Basically, it'll start from the most specific to the most generic.\nAlso, ",(0,i.jsx)(n.code,{children:"[ID]"})," is the uppercase ",(0,i.jsx)(n.code,{children:"id"})," value, and ",(0,i.jsx)(n.code,{children:"[FORMAT]"})," is the uppercase format\n(",(0,i.jsx)(n.code,{children:"deb"}),", ",(0,i.jsx)(n.code,{children:"rpm"}),", etc)."]}),"\n",(0,i.jsxs)(n.p,{children:["So, if your ",(0,i.jsx)(n.code,{children:"nfpms.id"})," is ",(0,i.jsx)(n.code,{children:"default"}),", then the deb-specific passphrase\nwill be set ",(0,i.jsx)(n.code,{children:"$NFPM_DEFAULT_DEB_PASSPHRASE"}),". Kmdo will try that, then\n",(0,i.jsx)(n.code,{children:"$NFPM_DEFAULT_PASSPHRASE"}),", and finally, ",(0,i.jsx)(n.code,{children:"$NFPM_PASSPHRASE"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"a-note-about-termux",children:"A note about Termux"}),"\n",(0,i.jsxs)(n.p,{children:["Termux is the same format as ",(0,i.jsx)(n.code,{children:"deb"}),", the differences are:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["it uses a different file structure (",(0,i.jsx)(n.code,{children:"/data/data/com.termux/files/"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bindir"})," is automatically adjusted, but other files might require extra\nconfiguration (see bellow)"]}),"\n",(0,i.jsx)(n.li,{children:"it uses slightly different architecture names than Debian"}),"\n",(0,i.jsx)(n.li,{children:"it will only package binaries built for Android"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example prefixing other files:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"nfpms:\n  - formats: [deb termux.deb rpm]\n    contents:\n      - src: ./foo.conf\n        dst: '{{ if eq .Format \"termux.deb\" }}/data/data/com.termux/files{{ end }}/usr/share/foo.conf'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"conventional-file-names-debian-and-armv6",children:"Conventional file names, Debian, and ARMv6"}),"\n",(0,i.jsxs)(n.p,{children:["On Debian, both ARMv6 and ARMv7 have the same architecture name: ",(0,i.jsx)(n.code,{children:"armhf"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you use ",(0,i.jsx)(n.code,{children:"{{.ConventionalFileName}}"}),", and build for both architectures, you'll\nget duplicated file names."]}),"\n",(0,i.jsx)(n.p,{children:"You can go around that with something like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'nfpms:\n  - # ...\n    file_name_template: >-\n      {{- trimsuffix .ConventionalFileName .ConventionalExtension -}}\n      {{- if and (eq .Arm "6") (eq .ConventionalExtension ".deb") }}6{{ end -}}\n      {{- if not (eq .Amd64 "v1")}}{{ .Amd64 }}{{ end -}}\n      {{- .ConventionalExtension -}}\n\n    # ...\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);
"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9287],{4191:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>h});const a=JSON.parse('{"id":"tutorial/pub/publish/release","title":"Release","description":"Kmdo can create a GitHub/GitLab/Gitea release with the current tag, upload","source":"@site/docs/tutorial/pub/publish/release.mdx","sourceDirName":"tutorial/pub/publish","slug":"/tutorial/pub/publish/release","permalink":"/zh-cn/docs/tutorial/pub/publish/release","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Custom Publishers","permalink":"/zh-cn/docs/tutorial/pub/publish/publishers"},"next":{"title":"Gitea","permalink":"/zh-cn/docs/tutorial/pub/publish/scm/gitea"}}');var i=n(4848),s=n(8453);const o={},l="Release",r={},h=[{value:"GitHub",id:"github",level:2},{value:"GitLab",id:"gitlab",level:2},{value:"Gitea",id:"gitea",level:2},{value:"Custom release notes",id:"custom-release-notes",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"release",children:"Release"})}),"\n",(0,i.jsx)(t.p,{children:"Kmdo can create a GitHub/GitLab/Gitea release with the current tag, upload\nall the artifacts and generate the changelog based on the new commits since the\nprevious tag."}),"\n",(0,i.jsx)(t.h2,{id:"github",children:"GitHub"}),"\n",(0,i.jsxs)(t.p,{children:["Let's see what can be customized in the ",(0,i.jsx)(t.code,{children:"release"})," section for GitHub:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"release:\n  # Repo in which the release will be created.\n  # Default: extracted from the origin remote URL or empty if its private hosted.\n  github:\n    owner: user\n    name: repo\n\n  # IDs of the archives to use.\n  # Empty means all IDs.\n  #\n  # Default: [].\n  ids:\n    - foo\n    - bar\n\n  # If set to true, will not auto-publish the release.\n  # Note: all GitHub releases start as drafts while artifacts are uploaded.\n  # Available only for GitHub and Gitea.\n  draft: true\n\n  # Whether to remove existing draft releases with the same name before creating\n  # a new one.\n  #\n  # Only effective if `draft` is set to true.\n  # Available only for GitHub.\n  replace_existing_draft: true\n\n  # Whether to use an existing draft release as the target release.\n  #\n  # Available only for GitHub.\n  use_existing_draft: true\n\n  # Whether to remove an artifact that already exists.\n  #\n  # Available only for GitHub.\n  # This might be a bit expensive (rate-limiting speaking), so it is only done\n  # when the upload of an artifact fails with a 422 (which means it already\n  # exists in the release).\n  # We then grab the list of artifacts from the release, and delete the file\n  # that matches the one we're trying to upload.\n  # Kmdo will then retry its upload.\n  replace_existing_artifacts: true\n\n  # Useful if you want to delay the creation of the tag in the remote.\n  # You can create the tag locally, but not push it, and run Kmdo.\n  # It'll then set the `target_commitish` portion of the GitHub release to the\n  # value of this field.\n  # Only works on GitHub.\n  #\n  # Default: ''.\n  # Templates: allowed.\n  target_commitish: \"{{ .Commit }}\"\n\n\n  # If set, will create a release discussion in the category specified.\n  #\n  # Warning: do not use categories in the 'Announcement' format.\n  #  Check https://github.com/kumose/kmdo/issues/2304 for more info.\n  #\n  # Default: ''.\n  discussion_category_name: General\n\n  # If set to auto, will mark the release as not ready for production\n  # in case there is an indicator for this in the tag e.g. v1.0.0-rc1\n  # If set to true, will mark the release as not ready for production.\n  # Default: false.\n  prerelease: auto\n\n  # If set to false, will NOT mark the release as \"latest\".\n  # This prevents it from being shown at the top of the release list,\n  # and from being returned when calling https://api.github.com/repos/OWNER/REPO/releases/latest.\n  #\n  # Available only for GitHub.\n  #\n  # Default: true.\n  # Templates: allowed. (Since v2.6)\n  make_latest: true\n\n  # What to do with the release notes in case the release already exists.\n  #\n  # Valid options are:\n  # - `keep-existing`: keep the existing notes\n  # - `append`: append the current release notes to the existing notes\n  # - `prepend`: prepend the current release notes to the existing notes\n  # - `replace`: replace existing notes\n  #\n  # Default: `keep-existing`.\n  mode: append\n\n  # Header for the release body.\n  #\n  # Templates: allowed.\n  header: |\n    ## Some title ({{ .Date }})\n\n    Welcome to this new release!\n\n\n  # Footer for the release body.\n  #\n  # Templates: allowed.\n  footer: |\n    ## Thanks\n\n    Those were the changes on {{ .Tag }}!\n\n\n  # You can change the name of the release.\n  #\n  # Default: '{{.Tag}}' ('{{.PrefixedTag}}' on Project).\n  # Templates: allowed.\n  name_template: \"{{.ProjectName}}-v{{.Version}} {{.Env.USER}}\"\n\n  # You can disable this pipe in order to not create the release on any SCM.\n  # Keep in mind that this might also break things that depend on the release\n  # URL, for instance, homebrew taps.\n  #\n  # Templates: allowed.\n  disable: true\n\n  # Set this to true if you want to disable just the artifact upload to the SCM.\n  # If this is true, Kmdo will still create the release with the\n  # changelog, but won't upload anything to it.\n  #\n  # Templates: allowed.\n  skip_upload: true\n\n  # You can add extra pre-existing files to the release.\n  # The filename on the release will be the last part of the path (base).\n  # If another file with the same name exists, the last one found will be used.\n  #\n  # Templates: allowed.\n  extra_files:\n    - glob: ./path/to/file.txt\n    - glob: ./glob/**/to/**/file/**/*\n    - glob: ./glob/foo/to/bar/file/foobar/override_from_previous\n    - glob: ./single_file.txt\n      name_template: file.txt # note that this only works if glob matches 1 file only\n\n\n  # Upload metadata.json and artifacts.json to the release as well.\n  include_meta: true\n\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"/zh-cn/docs/tutorial/pub/publish/scm/github",children:"Learn how to set up an API token, GitHub Enterprise, etc"}),"."]})}),"\n",(0,i.jsx)(t.h2,{id:"gitlab",children:"GitLab"}),"\n",(0,i.jsxs)(t.p,{children:["Let's see what can be customized in the ",(0,i.jsx)(t.code,{children:"release"})," section for GitLab."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"release:\n  # Default: extracted from the origin remote URL or empty if its private\n  #  hosted.\n  # You can also use Gitlab's internal project id by setting it in the name\n  #  field and leaving the owner field empty.\n  gitlab:\n    owner: user\n    name: repo\n\n  # IDs of the archives to use.\n  ids:\n    - foo\n    - bar\n\n  # You can change the name of the release.\n  #\n  # Default: '{{.Tag}}' ('{{.PrefixedTag}}' on project).\n  # Templates: allowed.\n  name_template: \"{{.ProjectName}}-v{{.Version}} {{.Env.USER}}\"\n\n  # You can disable this pipe in order to not upload any artifacts.\n  disable: true\n\n  # What to do with the release notes in case there the release already exists.\n  #\n  # Valid options are:\n  # - `keep-existing`: keep the existing notes\n  # - `append`: append the current release notes to the existing notes\n  # - `prepend`: prepend the current release notes to the existing notes\n  # - `replace`: replace existing notes\n  #\n  # Default: 'keep-existing'.\n  mode: append\n\n  # You can add extra pre-existing files to the release.\n  # The filename on the release will be the last part of the path (base).\n  # If another file with the same name exists, the last one found will be used.\n  #\n  # Templates: allowed.\n  extra_files:\n    - glob: ./path/to/file.txt\n    - glob: ./glob/**/to/**/file/**/*\n    - glob: ./glob/foo/to/bar/file/foobar/override_from_previous\n    - glob: ./single_file.txt\n      name_template: file.txt # note that this only works if glob matches 1 file only\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"/zh-cn/docs/tutorial/pub/publish/scm/gitlab",children:"Learn how to set up an API token, self-hosted GitLab, etc"}),"."]})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:["If you use GitLab subgroups, you need to specify it in the ",(0,i.jsx)(t.code,{children:"owner"})," field,\ne.g. ",(0,i.jsx)(t.code,{children:"mygroup/mysubgroup"}),"."]})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:["Only GitLab ",(0,i.jsx)(t.code,{children:"v12.9+"})," is supported for releases."]})}),"\n",(0,i.jsx)(t.h2,{id:"gitea",children:"Gitea"}),"\n",(0,i.jsxs)(t.p,{children:["You can also configure the ",(0,i.jsx)(t.code,{children:"release"})," section to upload to a ",(0,i.jsx)(t.a,{href:"https://gitea.io",children:"Gitea"})," instance:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"release:\n  gitea:\n    owner: user\n    name: repo\n\n  # IDs of the artifacts to use.\n  ids:\n    - foo\n    - bar\n\n  # You can change the name of the release.\n  #\n  # Default: '{{.Tag}}' ('{{.PrefixedTag}}' on project).\n  # Templates: allowed.\n  name_template: \"{{.ProjectName}}-v{{.Version}} {{.Env.USER}}\"\n\n  # You can disable this pipe in order to not upload any artifacts.\n  disable: true\n\n  # What to do with the release notes in case there the release already exists.\n  #\n  # Valid options are:\n  # - `keep-existing`: keep the existing notes\n  # - `append`: append the current release notes to the existing notes\n  # - `prepend`: prepend the current release notes to the existing notes\n  # - `replace`: replace existing notes\n  #\n  # Default: 'keep-existing'.\n  mode: append\n\n  # You can add extra pre-existing files to the release.\n  # The filename on the release will be the last part of the path (base).\n  # If another file with the same name exists, the last one found will be used.\n  #\n  # Templates: allowed.\n  extra_files:\n    - glob: ./path/to/file.txt\n    - glob: ./glob/**/to/**/file/**/*\n    - glob: ./glob/foo/to/bar/file/foobar/override_from_previous\n    - glob: ./single_file.txt\n      name_template: file.txt # note that this only works if glob matches 1 file only\n"})}),"\n",(0,i.jsxs)(t.p,{children:["To enable uploading ",(0,i.jsx)(t.code,{children:"tar.gz"})," and ",(0,i.jsx)(t.code,{children:"checksums.txt"})," files you need to add the\nfollowing to your Gitea config in ",(0,i.jsx)(t.code,{children:"app.ini"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ini",children:"[attachment]\nALLOWED_TYPES = application/gzip|application/x-gzip|application/x-gtar|application/x-tgz|application/x-compressed-tar|text/plain\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"/zh-cn/docs/tutorial/pub/publish/scm/gitea",children:"Learn how to set up an API token"}),"."]})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:["Gitea versions earlier than 1.9.2 do not support uploading ",(0,i.jsx)(t.code,{children:"checksums.txt"}),"\nfiles because of a ",(0,i.jsx)(t.a,{href:"https://github.com/go-gitea/gitea/issues/7882",children:"bug"}),",\nso you will have to enable all file types with ",(0,i.jsx)(t.code,{children:"*/*"}),"."]})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"draft"})," and ",(0,i.jsx)(t.code,{children:"prerelease"})," are only supported by GitHub and Gitea."]})}),"\n",(0,i.jsx)(t.h2,{id:"custom-release-notes",children:"Custom release notes"}),"\n",(0,i.jsxs)(t.p,{children:["You can specify a file containing your custom release notes, and pass it with\nthe ",(0,i.jsx)(t.code,{children:"--release-notes=FILE"})," flag. Kmdo will then skip its own release notes\ngeneration, using the contents of your file instead. You can use Markdown to\nformat the contents of your file."]}),"\n",(0,i.jsxs)(t.p,{children:["On Unix systems you can also generate the release notes in-line by using\n",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Process_substitution",children:"process substitution"}),". To\nlist all commits since the last tag, but skip ones starting with ",(0,i.jsx)(t.code,{children:"Merge"})," or\n",(0,i.jsx)(t.code,{children:"docs"}),", you could run this command:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sh",children:"kmdo pub release --release-notes <(some_changelog_generator)\n"})}),"\n",(0,i.jsx)(t.p,{children:"Some changelog generators you can use:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/buchanae/github-release-notes",children:"buchanae/github-release-notes"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/miniscruff/changie",children:"miniscruff/changie"})}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"If you create the release before running Kmdo, and the said release\nhas some text in its body, Kmdo will not override it with its release\nnotes."})})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>l});var a=n(6540);const i={},s=a.createContext(i);function o(e){const t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);
"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[1951],{590:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"tutorial/pub/publish/scoop","title":"Scoop Manifests","description":"After releasing to GitHub, GitLab, or Gitea, Kmdo can generate and publish a","source":"@site/docs/tutorial/pub/publish/scoop.mdx","sourceDirName":"tutorial/pub/publish","slug":"/tutorial/pub/publish/scoop","permalink":"/zh-cn/docs/tutorial/pub/publish/scoop","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"GitLab","permalink":"/zh-cn/docs/tutorial/pub/publish/scm/gitlab"},"next":{"title":"Snapshots","permalink":"/zh-cn/docs/tutorial/pub/publish/snapshots"}}');var s=t(4848),a=t(8453);const r={},i="Scoop Manifests",l={},c=[{value:"Pull Requests",id:"pull-requests",level:2},{value:"Templates",id:"templates",level:3},{value:"Cross-repository pull requests",id:"cross-repository-pull-requests",level:3},{value:"Things that don&#39;t work",id:"things-that-dont-work",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",sup:"sup",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"scoop-manifests",children:"Scoop Manifests"})}),"\n",(0,s.jsxs)(n.p,{children:["After releasing to GitHub, GitLab, or Gitea, Kmdo can generate and publish a\n",(0,s.jsx)(n.em,{children:"Scoop App Manifest"})," into a repository that you have access to."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"scoop"})," section specifies how the manifest should be created. See the\ncommented example below:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"scoops:\n  - # Name of the recipe\n    #\n    # Default: the project name.\n    # Templates: allowed.\n    name: myproject\n\n    # URL which is determined by the given Token (github or gitlab)\n    #\n    # Default:\n    #   GitHub: 'https://github.com/<repo_owner>/<repo_name>/releases/download/{{ .Tag }}/{{ .ArtifactName }}'\n    #   GitLab: 'https://gitlab.com/<repo_owner>/<repo_name>/-/releases/{{ .Tag }}/downloads/{{ .ArtifactName }}'\n    #   Gitea: 'https://gitea.com/<repo_owner>/<repo_name>/releases/download/{{ .Tag }}/{{ .ArtifactName }}'\n    # Templates: allowed.\n    url_template: \"http://github.mycompany.com/foo/bar/releases/{{ .Tag }}/{{ .ArtifactName }}\"\n\n    # Directory inside the repository to put the scoop.\n    #\n    # Note that while scoop works if the manifests are in a directory,\n    # 'scoop bucket list' will show 0 manifests if they are not in the root\n    # directory.\n    # In short, it's generally better to leave this empty.\n    directory: Scoops\n\n\n    # The project name and current git tag are used in the format string.\n    #\n    # Templates: allowed.\n    commit_msg_template: \"Scoop update for {{ .ProjectName }} version {{ .Tag }}\"\n\n    # Your app's homepage.\n    #\n    # Templates: allowed.\n    # Default: inferred from global metadata.\n    homepage: \"https://example.com/\"\n\n    # Your app's description.\n    #\n    # Templates: allowed.\n    # Default: inferred from global metadata.\n    description: \"Software to create fast and easy drum rolls.\"\n\n    # Your app's license\n    #\n    # Default: inferred from global metadata.\n    license: MIT\n\n    # Setting this will prevent kumose to actually try to commit the updated\n    # manifest leaving the responsibility of publishing it to the user.\n    # If set to auto, the release will not be uploaded to the scoop bucket\n    # in case there is an indicator for prerelease in the tag e.g. v1.0.0-rc1\n    #\n    # Templates: allowed.\n    skip_upload: true\n\n    # Persist data between application updates\n    persist:\n      - \"data\"\n      - \"config.toml\"\n\n    # An array of commands to be executed before an application is installed.\n    pre_install: [\"Write-Host 'Running preinstall command'\"]\n\n    # An array of commands to be executed after an application is installed.\n    post_install: [\"Write-Host 'Running postinstall command'\"]\n\n    # An array of dependencies.\n    depends: [\"git\", \"foo\"]\n\n    # A two-dimensional array of string, specifies the shortcut values to make available in the startmenu.\n    # The array has to contain an executable/label pair. The third and fourth element are optional.\n    shortcuts: [[\"drumroll.exe\", \"drumroll\"]]\n\n    # GOAMD64 to specify which amd64 version to use if there are multiple versions\n    # from the build section.\n    #\n    # Default: 'v1'.\n    goamd64: v3\n\n    # Repository to push the generated files to.\n    repository:\n      # Repository owner.\n      #\n      # Templates: allowed.\n      owner: caarlos0\n\n      # Repository name.\n      #\n      # Templates: allowed.\n      name: my-repo\n\n      # Optionally a branch can be provided.\n      #\n      # Default: default repository branch.\n      # Templates: allowed.\n      branch: main\n\n      # Optionally a token can be provided, if it differs from the token\n      # provided to Kmdo\n      #\n      # Templates: allowed.\n      token: \"{{ .Env.GITHUB_PERSONAL_AUTH_TOKEN }}\"\n\n\n      # Sets up pull request creation instead of just pushing to the given branch.\n      # Make sure the 'branch' property is different from base before enabling\n      # it.\n      #\n      # This might require a personal access token.\n      pull_request:\n        # Whether to enable it or not.\n        enabled: true\n\n        # Whether to open the PR as a draft or not.\n        draft: true\n\n        # Allows to set a body for the pull request.\n        # If the repository has a pull request template, it will be appended to\n        # this.\n        body: |\n          cc/ @foobar\n\n        # Base can also be another repository, in which case the owner and name\n        # above will be used as HEAD, allowing cross-repository pull requests.\n        base:\n          owner: kumose\n          name: my-repo\n          branch: main\n\n      # Clone, create the file, commit and push, to a regular Git repository.\n      #\n      # Notice that this will only have any effect if the given URL is not\n      # empty.\n      git:\n        # The Git URL to push.\n        #\n        # Templates: allowed.\n        url: 'ssh://git@myserver.com:repo.git'\n\n        # The SSH private key that should be used to commit to the Git\n        # repository.\n        # This can either be a path or the key contents.\n        #\n        # IMPORTANT: the key must not be password-protected.\n        #\n        # WARNING: do not expose your private key in the configuration file!\n        #\n        # Templates: allowed.\n        private_key: '{{ .Env.PRIVATE_KEY_PATH }}'\n\n        # The value to be passed to `GIT_SSH_COMMAND`.\n        # This is mainly used to specify the SSH private key used to pull/push\n        # to the Git URL.\n        #\n        # Default: 'ssh -i {{ .KeyPath }} -o StrictHostKeyChecking=accept-new -F /dev/null'.\n        # Templates: allowed.\n        ssh_command: 'ssh -i {{ .Env.KEY }} -o SomeOption=yes'\n\n    # Git author used to commit to the repository.\n    #\n    # Default: inferred from global metadata.\n    commit_author:\n      # Git author name.\n      #\n      # Templates: allowed.\n      name: kumosebot\n\n      # Git author email.\n      #\n      # Templates: allowed.\n      email: bot@kumose.cc\n\n      # Git commit signing configuration.\n      # Only useful if repository is of type 'git'.\n      signing:\n        # Enable commit signing.\n        enabled: true\n\n        # The signing key to use.\n        # Can be a key ID, fingerprint, email address, or path to a key file.\n        #\n        # Templates: allowed.\n        key: \"{{ .Env.GPG_SIGNING_KEY }}\"\n\n        # The GPG program to use for signing.\n        #\n        # Templates: allowed.\n        program: gpg2\n\n        # The signature format to use.\n        #\n        # Valid options: openpgp, x509, ssh.\n        # Default: openpgp.\n        format: openpgp\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["By defining the ",(0,s.jsx)(n.code,{children:"scoop"})," section, Kmdo will take care of publishing the\nScoop app. Assuming that the project name is ",(0,s.jsx)(n.code,{children:"drumroll"}),", and the current tag is\n",(0,s.jsx)(n.code,{children:"v1.2.3"}),", the above configuration will generate a ",(0,s.jsx)(n.code,{children:"drumroll.json"})," manifest in\nthe root of the repository specified in the ",(0,s.jsx)(n.code,{children:"bucket"})," section."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "version": "1.2.3",\n  "architecture": {\n    "64bit": {\n      "url": "https://github.com/user/drumroll/releases/download/1.2.3/drumroll_1.2.3_windows_amd64.tar.gz",\n      "bin": "drumroll.exe",\n      "hash": "86920b1f04173ee08773136df31305c0dae2c9927248ac259e02aafd92b6008a"\n    },\n    "32bit": {\n      "url": "https://github.com/user/drumroll/releases/download/1.2.3/drumroll_1.2.3_windows_386.tar.gz",\n      "bin": "drumroll.exe",\n      "hash": "283faa524ef41987e51c8786c61bb56658a489f63512b32139d222b3ee1d18e6"\n    }\n  },\n  "homepage": "https://example.com/"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Your users can then install your app by doing:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"scoop bucket add org https://github.com/org/repo.git\nscoop install org/drumroll\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can check the\n",(0,s.jsx)(n.a,{href:"https://github.com/lukesampson/scoop/wiki",children:"Scoop documentation"})," for more\ndetails."]}),"\n",(0,s.jsx)(n.h2,{id:"pull-requests",children:"Pull Requests"}),"\n",(0,s.jsx)(n.p,{children:"Kmdo allows you to, instead of pushing directly to the main branch, push\nto a feature branch, and open a pull requests with the changes."}),"\n",(0,s.jsx)(n.h3,{id:"templates",children:"Templates"}),"\n",(0,s.jsxs)(n.p,{children:["Kmdo will check for a ",(0,s.jsx)(n.code,{children:".github/PULL_REQUEST_TEMPLATE.md"}),", and set it in\nthe pull request body if it exists."]}),"\n",(0,s.jsxs)(n.p,{children:["We do that to prevent extra work for maintainers of things like ",(0,s.jsx)(n.code,{children:"winget-pkgs"}),",\n",(0,s.jsx)(n.code,{children:"nixpkgs"}),", and so on."]}),"\n",(0,s.jsx)(n.h3,{id:"cross-repository-pull-requests",children:"Cross-repository pull requests"}),"\n",(0,s.jsx)(n.p,{children:"You can also push to a fork, and open the pull request in the original branch."}),"\n",(0,s.jsx)(n.p,{children:"Here's an example on how to set it up:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'# ...\nsomething: # can be nix, brews, etc...\n  - repository:\n      owner: john\n      name: repo\n      branch: "{{.ProjectName}}-{{.Version}}"\n      pull_request:\n        enabled: true\n        base:\n          owner: mike\n          name: repo\n          branch: main\n'})}),"\n",(0,s.jsx)(n.p,{children:"This will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Try to sync the ",(0,s.jsx)(n.code,{children:"john/repo"})," fork with ",(0,s.jsx)(n.code,{children:"mike/repo:main"})," (if on GitHub)."]}),"\n",(0,s.jsxs)(n.li,{children:["Create the files into ",(0,s.jsx)(n.code,{children:"john/repo"}),", in the branch ",(0,s.jsx)(n.code,{children:"foo-1.2.3"})," (assuming\n",(0,s.jsx)(n.code,{children:"ProjectName=foo"})," and ",(0,s.jsx)(n.code,{children:"Version=1.2.3"}),"). ",(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-head",id:"user-content-fnref-head","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]}),"\n",(0,s.jsxs)(n.li,{children:["Open a pull request from ",(0,s.jsx)(n.code,{children:"john/repo"})," into ",(0,s.jsx)(n.code,{children:"mike/repo"}),", with the branch ",(0,s.jsx)(n.code,{children:"main"}),"\nas target. ",(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-base",id:"user-content-fnref-base","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"things-that-dont-work",children:"Things that don't work"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Opening pull requests to a forked repository (",(0,s.jsx)(n.code,{children:"go-github"})," does not have the\nrequired fields to do it)."]}),"\n",(0,s.jsx)(n.li,{children:"Since this can fail for a myriad of reasons, if an error happen, it'll log it\nto the release output, but will not fail the pipeline."}),"\n"]}),"\n","\n",(0,s.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,s.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{id:"user-content-fn-head",children:["\n",(0,s.jsxs)(n.p,{children:["In GitHub's terms, this means ",(0,s.jsx)(n.code,{children:"head=john:repo:foo-1.2.3"})," ",(0,s.jsx)(n.a,{href:"#user-content-fnref-head","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{id:"user-content-fn-base",children:["\n",(0,s.jsxs)(n.p,{children:["In GitHub's terms, this means ",(0,s.jsx)(n.code,{children:"base=mike:repo:main"})," ",(0,s.jsx)(n.a,{href:"#user-content-fnref-base","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var o=t(6540);const s={},a=o.createContext(s);function r(e){const n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);
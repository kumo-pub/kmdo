"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3216],{3629:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"tutorial/pub/builds/rust","title":"Rust","description":"You can now build Rust binaries using cargo zigbuild and Kmdo!","source":"@site/docs/tutorial/pub/builds/rust.mdx","sourceDirName":"tutorial/pub/builds","slug":"/tutorial/pub/builds/rust","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/rust","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Poetry","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/poetry"},"next":{"title":"UPX","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/upx"}}');var o=t(4848),a=t(8453);const r={},i="Rust",l={},d=[{value:"Publishing with Cargo",id:"publishing-with-cargo",level:2},{value:"Caveats",id:"caveats",level:2},{value:"Targets",id:"targets",level:3},{value:"Environment setup",id:"environment-setup",level:3},{value:"Cargo Workspaces",id:"cargo-workspaces",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"rust",children:"Rust"})}),"\n",(0,o.jsxs)(n.p,{children:["You can now build Rust binaries using ",(0,o.jsx)(n.code,{children:"cargo zigbuild"})," and Kmdo!"]}),"\n",(0,o.jsxs)(n.p,{children:["Simply set the ",(0,o.jsx)(n.code,{children:"builder"})," to ",(0,o.jsx)(n.code,{children:"rust"}),", for instance:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  # You can have multiple builds defined as a yaml list\n  - #\n    # ID of the build.\n    #\n    # Default: Project directory name.\n    id: "my-build"\n\n    # Use rust.\n    builder: rust\n\n    # Binary name.\n    # Can be a path (e.g. `bin/app`) to wrap the binary in a directory.\n    #\n    # Default: Project directory name.\n    binary: program\n\n    # List of targets to be built, in Rust\'s format.\n    # Default: [ "x86_64-unknown-linux-gnu", "x86_64-apple-darwin", "x86_64-pc-windows-gnu", "aarch64-unknown-linux-gnu", "aarch64-apple-darwin" ]\n    targets:\n      - x86_64-apple-darwin\n      - x86_64-pc-windows-gnu\n\n    # Path to project\'s (sub)directory containing the code.\n    # This is the working directory for the cargo build command(s).\n    #\n    # Default: \'.\'.\n    dir: my-app\n\n    # Set a specific cargo binary to use when building.\n    # It is safe to ignore this option in most cases.\n    #\n    # Default: "cargo".\n    # Templates: allowed.\n    tool: "cross"\n\n    # Sets the command to run to build.\n    # Can be useful if you want to build tests, for example,\n    # in which case you can set this to "test".\n    # It is safe to ignore this option in most cases.\n    #\n    # Default: zigbuild.\n    command: build\n\n    # Custom flags.\n    #\n    # Templates: allowed.\n    # Default: "--release".\n    flags:\n      - --release\n      - -p=subproject # when using cargo-workspaces\n\n    # Custom environment variables to be set during the builds.\n    # Invalid environment variables will be ignored.\n    #\n    # Default: os.Environ() ++ env config section.\n    # Templates: allowed.\n    env:\n      - FOO=bar\n\n    # Hooks can be used to customize the final binary,\n    # for example, to run generators.\n    #\n    # Templates: allowed.\n    hooks:\n      pre: ./foo.sh\n      post: ./script.sh {{ .Path }}\n\n    # If true, skip the build.\n    # Useful for library projects.\n    skip: false\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Some options are not supported yet",(0,o.jsx)(n.sup,{children:(0,o.jsx)(n.a,{href:"#user-content-fn-fail",id:"user-content-fnref-fail","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})}),", but it should be usable at least for\nsimple projects already!"]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["Learn more about ",(0,o.jsx)(n.a,{href:"/kmdo/zh-cn/docs/tutorial/pub/builds/hooks",children:"build hooks"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["Kmdo will run ",(0,o.jsx)(n.code,{children:"rustup target add"})," for each defined target.\nYou can use before hooks to install ",(0,o.jsx)(n.code,{children:"cargo-zigbuild"}),".\nIf you want to use ",(0,o.jsx)(n.code,{children:"cargo-cross"})," instead, you can make sure it is installed and\nthen make few changes:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"builds:\n  - # Use cargo cross:\n    builder: rust\n    tool: cross\n    command: build\n    targets:\n      - x86_64-apple-darwin\n      - x86_64-pc-windows-gnu\n"})}),"\n",(0,o.jsx)(n.h2,{id:"publishing-with-cargo",children:"Publishing with Cargo"}),"\n",(0,o.jsxs)(n.p,{children:["You can use ",(0,o.jsx)(n.a,{href:"/kmdo/zh-cn/docs/tutorial/pub/general/hooks",children:"global after hooks"})," to do it:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'# global after hooks\nafter:\n  - cmd: "cargo publish {{ if .IsSnapshot }}--dry-run{{ end }} --quiet --no-verify"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,o.jsx)(n.h3,{id:"targets",children:"Targets"}),"\n",(0,o.jsxs)(n.p,{children:["Kmdo will translate Rust's Os/Arch triple into a GOOS/GOARCH pair, so\ntemplates should work the same as before.\nThe original target name is available in templates as ",(0,o.jsx)(n.code,{children:".Target"}),", and so are\n",(0,o.jsx)(n.code,{children:".Vendor"})," and ",(0,o.jsx)(n.code,{children:".Environment"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"environment-setup",children:"Environment setup"}),"\n",(0,o.jsx)(n.p,{children:"Kmdo will not install Cargo, Rustup, Zig, or cargo-zigbuild for you.\nMake sure to install them before running Kmdo."}),"\n",(0,o.jsxs)(n.p,{children:["Remember that you may also need to run ",(0,o.jsx)(n.code,{children:"rustup default stable"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Kmdo ",(0,o.jsx)(n.strong,{children:"will"}),", however, run ",(0,o.jsx)(n.code,{children:"rustup target add"})," for each target you\ndeclare."]}),"\n",(0,o.jsxs)(n.p,{children:["You can also add them to your ",(0,o.jsx)(n.a,{href:"/kmdo/zh-cn/docs/tutorial/pub/general/hooks",children:"global before hooks"}),", e.g.:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"before:\n  hooks:\n    - rustup default stable\n    - cargo install --locked cargo-zigbuild\n"})}),"\n",(0,o.jsx)(n.h3,{id:"cargo-workspaces",children:"Cargo Workspaces"}),"\n",(0,o.jsxs)(n.p,{children:["Projects that use Cargo workspaces might not work depending on usage.\nIf you want to try it, add ",(0,o.jsx)(n.code,{children:"-p=[name]"})," to the ",(0,o.jsx)(n.code,{children:"flags"})," property.\nWe might improve this in the future."]}),"\n","\n",(0,o.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,o.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{id:"user-content-fn-fail",children:["\n",(0,o.jsxs)(n.p,{children:["Kmdo will error if you try to use them. Give it a try with\n",(0,o.jsx)(n.code,{children:"kmdo pub r --snapshot --clean"}),". ",(0,o.jsx)(n.a,{href:"#user-content-fnref-fail","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var s=t(6540);const o={},a=s.createContext(o);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);
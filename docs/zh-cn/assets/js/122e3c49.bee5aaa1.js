"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9970],{2840:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"tutorial/pub/builds/poetry","title":"Poetry","description":"You can now build Python wheel and sdist files using poetry build and","source":"@site/docs/tutorial/pub/builds/poetry.mdx","sourceDirName":"tutorial/pub/builds","slug":"/tutorial/pub/builds/poetry","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/poetry","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"NOOP","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/noop"},"next":{"title":"Rust","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/rust"}}');var o=t(4848),s=t(8453);const l={},d="Poetry",r={},a=[{value:"Options",id:"options",level:2},{value:"Building both wheel and sdist",id:"building-both-wheel-and-sdist",level:2},{value:"Publishing to PyPi",id:"publishing-to-pypi",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"poetry",children:"Poetry"})}),"\n",(0,o.jsxs)(n.p,{children:["You can now build Python ",(0,o.jsx)(n.code,{children:"wheel"})," and ",(0,o.jsx)(n.code,{children:"sdist"})," files using ",(0,o.jsx)(n.code,{children:"poetry build"})," and\nKmdo!"]}),"\n",(0,o.jsxs)(n.p,{children:["Simply set the ",(0,o.jsx)(n.code,{children:"builder"})," to ",(0,o.jsx)(n.code,{children:"poetry"})," and set the ",(0,o.jsx)(n.code,{children:"buildmode"})," you want:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"builds:\n  - builder: poetry\n    buildmode: wheel\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:".whl"})," and ",(0,o.jsx)(n.code,{children:".tar.gz"})," files can then be signed, checksummed, used inside\nDocker images, and more."]}),"\n",(0,o.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  # You can have multiple builds defined as a yaml list\n  - #\n    # ID of the build.\n    #\n    # Default: Project directory name.\n    id: "my-build"\n\n    # Use poetry.\n    builder: poetry\n\n    # Path to project\'s (sub)directory containing the code.\n    # This is the working directory for the poetry build command(s).\n    #\n    # Default: ".".\n    dir: my-app\n\n    # The build mode.\n    #\n    # Valid options: "wheel", "sdist".\n    # Default: "wheel".\n    buildmode: sdist\n\n    # Set a specific poetry binary to use when building.\n    # It is safe to ignore this option in most cases.\n    #\n    # Default: "poetry".\n    # Templates: allowed.\n    tool: poetry\n\n    # Sets the command to run to build.\n    # Can be useful if you want to build tests, for example,\n    # in which case you can set this to "test".\n    # It is safe to ignore this option in most cases.\n    #\n    # Default: build.\n    command: build\n\n    # Custom flags.\n    #\n    # Templates: allowed.\n    flags:\n      - --no-cache\n\n    # Custom environment variables to be set during the builds.\n    # Invalid environment variables will be ignored.\n    #\n    # Default: os.Environ() ++ env config section.\n    # Templates: allowed.\n    env:\n      - FOO=bar\n\n    # Hooks can be used to customize the final binary,\n    # for example, to run generators.\n    #\n    # Templates: allowed.\n    hooks:\n      pre: ./foo.sh\n      post: ./script.sh {{ .Path }}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["At this time only the target ",(0,o.jsx)(n.code,{children:"py3-none-any"})," is supported."]})}),"\n",(0,o.jsx)(n.h2,{id:"building-both-wheel-and-sdist",children:"Building both wheel and sdist"}),"\n",(0,o.jsx)(n.p,{children:"You need to declare 2 builds, one for each mode:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"builds:\n  - id: wheel\n    builder: poetry\n    buildmode: wheel\n  - id: sdist\n    builder: poetry\n    buildmode: sdist\n"})}),"\n",(0,o.jsx)(n.h2,{id:"publishing-to-pypi",children:"Publishing to PyPi"}),"\n",(0,o.jsxs)(n.p,{children:["You can use ",(0,o.jsx)(n.a,{href:"/kmdo/zh-cn/docs/tutorial/pub/general/hooks",children:"global after hooks"})," to do it:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'# global after hooks\nafter:\n  - cmd: "poetry publish"\n    if: "{{ .IsRelease }}"\n'})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>d});var i=t(6540);const o={},s=i.createContext(o);function l(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);
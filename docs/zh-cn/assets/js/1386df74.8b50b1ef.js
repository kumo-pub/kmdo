"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3174],{3030:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"tutorial/pub/publish/artifactory","title":"Artifactory","description":"Publish your artifacts to an Artifactory instance.","source":"@site/docs/tutorial/pub/publish/artifactory.mdx","sourceDirName":"tutorial/pub/publish","slug":"/tutorial/pub/publish/artifactory","permalink":"/kmdo/zh-cn/docs/tutorial/pub/publish/artifactory","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Kmdo pub","permalink":"/kmdo/zh-cn/docs/tutorial/pub/overview"},"next":{"title":"Arch User Repositories","permalink":"/kmdo/zh-cn/docs/tutorial/pub/publish/aur"}}');var i=t(4848),r=t(8453);const o={},s="Artifactory",c={},l=[{value:"How it works",id:"how-it-works",level:2},{value:"Target",id:"target",level:3},{value:"Username",id:"username",level:3},{value:"Password / API Key",id:"password--api-key",level:3},{value:"Client authorization with x509 certificate (mTLS / mutual TLS)",id:"client-authorization-with-x509-certificate-mtls--mutual-tls",level:3},{value:"Server authentication",id:"server-authentication",level:3},{value:"Client checksum headers",id:"client-checksum-headers",level:3},{value:"Customization",id:"customization",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"artifactory",children:"Artifactory"})}),"\n",(0,i.jsx)(n.p,{children:"Publish your artifacts to an Artifactory instance."}),"\n",(0,i.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,i.jsxs)(n.p,{children:["You can declare multiple Artifactory instances.\nAll binaries generated by your ",(0,i.jsx)(n.code,{children:"builds"})," section will be pushed to\neach configured Artifactory."]}),"\n",(0,i.jsxs)(n.p,{children:["If you have only one Artifactory instance,\nthe configuration is as easy as adding the\nupload target, and a username to your ",(0,i.jsx)(n.code,{children:".kmdopkg.yaml"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"artifactories:\n  - name: production\n    target: http://<Your-Instance>:8081/artifactory/example-repo-local/{{ .ProjectName }}/{{ .Version }}/\n    username: kumose\n"})}),"\n",(0,i.jsx)(n.p,{children:"Prerequisites:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A running Artifactory instances"}),"\n",(0,i.jsx)(n.li,{children:"A user + password / client x509 certificate / API key with grants to upload\nan artifact"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"target",children:"Target"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"target"})," is the URL to upload the artifacts to (",(0,i.jsx)(n.em,{children:"without"})," the name of the\nartifact)."]}),"\n",(0,i.jsxs)(n.p,{children:["An example configuration for ",(0,i.jsx)(n.code,{children:"kumose"})," in upload mode ",(0,i.jsx)(n.code,{children:"binary"})," with the\ntarget can look like"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'- mode: binary\n  target: "http://artifacts.company.com:8081/artifactory/example-repo-local/{{ .ProjectName }}/{{ .Version }}/{{ .Os }}/{{ .Arch }}{{ if .Arm }}{{ .Arm }}{{ end }}"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["And will result in a final deployment like\n",(0,i.jsx)(n.code,{children:"http://artifacts.company.com:8081/artifactory/example-repo-local/kumose/1.0.0/Darwin/x86_64/kmdo"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Supported variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Version"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Tag"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"ProjectName"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Os"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Arch"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Arm"})}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Variables ",(0,i.jsx)(n.em,{children:"Os"}),", ",(0,i.jsx)(n.em,{children:"Arch"})," and ",(0,i.jsx)(n.em,{children:"Arm"})," are only supported in upload mode ",(0,i.jsx)(n.code,{children:"binary"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"username",children:"Username"}),"\n",(0,i.jsx)(n.p,{children:"Your configured username needs to be authenticated against your Artifactory."}),"\n",(0,i.jsxs)(n.p,{children:["You can have the username set in the configuration file as shown above, or you\ncan have it read from an environment variable. The configured name of your\nArtifactory instance will be used to build the environment variable name. This\nway we support authentication for multiple instances. This also means that the\n",(0,i.jsx)(n.code,{children:"name"})," per configured instance needs to be unique per Kmdo configuration."]}),"\n",(0,i.jsxs)(n.p,{children:["The name of the environment variable will be ",(0,i.jsx)(n.code,{children:"ARTIFACTORY_NAME_USERNAME"}),".\nIf your instance is named ",(0,i.jsx)(n.code,{children:"production"}),", you can store the username in the\nenvironment variable ",(0,i.jsx)(n.code,{children:"ARTIFACTORY_PRODUCTION_USERNAME"}),".\nThe name will be transformed to uppercase."]}),"\n",(0,i.jsx)(n.p,{children:"If a configured username is found in the configuration file, then the\nenvironment variable is not used at all."}),"\n",(0,i.jsx)(n.h3,{id:"password--api-key",children:"Password / API Key"}),"\n",(0,i.jsxs)(n.p,{children:["The password or API key will be stored in an environment variable.\nThe configured name of your Artifactory instance will be used.\nWith this way we support auth for multiple instances.\nThis also means that the ",(0,i.jsx)(n.code,{children:"name"})," per configured instance needs to be unique\nper Kmdo configuration."]}),"\n",(0,i.jsxs)(n.p,{children:["The name of the environment variable will be ",(0,i.jsx)(n.code,{children:"ARTIFACTORY_NAME_SECRET"}),".\nIf your instance is named ",(0,i.jsx)(n.code,{children:"production"}),", you need to store the secret in the\nenvironment variable ",(0,i.jsx)(n.code,{children:"ARTIFACTORY_PRODUCTION_SECRET"}),".\nThe name will be transformed to uppercase."]}),"\n",(0,i.jsx)(n.h3,{id:"client-authorization-with-x509-certificate-mtls--mutual-tls",children:"Client authorization with x509 certificate (mTLS / mutual TLS)"}),"\n",(0,i.jsx)(n.p,{children:"If your artifactory server supports authorization with mTLS (client\ncertificates), you can provide them by specifying the location of an x509\ncertificate/key pair of pem-encode files."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"artifactories:\n  - name: production\n    target: http://<Your-Instance>:8081/artifactory/example-repo-local/{{ .ProjectName }}/{{ .Version }}/\n    client_x509_cert: path/to/client.cert.pem\n    client_x509_key: path/to/client.key.pem\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will offer the client certificate during the TLS handshake, which your\nartifactory server may use to authenticate and authorize you to upload."}),"\n",(0,i.jsx)(n.h3,{id:"server-authentication",children:"Server authentication"}),"\n",(0,i.jsx)(n.p,{children:"You can authenticate your Artifactory TLS server adding a trusted X.509\ncertificate chain in your configuration."}),"\n",(0,i.jsx)(n.p,{children:"The trusted certificate chain will be used to validate the server certificates."}),"\n",(0,i.jsxs)(n.p,{children:["You can set the trusted certificate chain using the ",(0,i.jsx)(n.code,{children:"trusted_certificates"}),"\nsetting the artifactory section with PEM encoded certificates on a YAML literal\nblock like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'puts:\n  - name: "some artifactory server with a private TLS certificate"\n    #...(other settings)...\n    trusted_certificates: |\n      -----BEGIN CERTIFICATE-----\n      MIIDrjCCApagAwIBAgIIShr2zchZo+8wDQYJKoZIhvcNAQENBQAwNTEXMBUGA1UE\n      ...(edited content)...\n      TyzMJasj5BPZrmKjJb6O/tOtEIJ66xPSBTxPShkEYHnB7A==\n      -----END CERTIFICATE-----\n      -----BEGIN CERTIFICATE-----\n      MIIDrjCCApagAwIBAgIIShr2zchZo+8wDQYJKoZIhvcNAQENBQAwNTEXMBUGA1UE\n      ...(edited content)...\n      TyzMJasj5BPZrmKjJb6O/tOtEIJ66xPSBTxPShkEYHnB7A==\n      -----END CERTIFICATE-----\n'})}),"\n",(0,i.jsx)(n.h3,{id:"client-checksum-headers",children:"Client checksum headers"}),"\n",(0,i.jsxs)(n.p,{children:["With its default checksum policy, Artifactory requires ",(0,i.jsx)(n.a,{href:"https://jfrog.com/help/r/what-are-client-checksum-server-checksum-and-checksum-policy-in-local-repositories",children:"checksum headers"})," from the client for all uploaded artifacts.\nWhen the client deploys a checksum header with a file, Artifactory calculates the file's checksum and compares it to the client-provided value."]}),"\n",(0,i.jsxs)(n.p,{children:["You can add the checksum headers to your upload configuration using the ",(0,i.jsx)(n.code,{children:"custom_headers"})," field:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'artifactories:\n  - name: production\n    target: http://<Your-Instance>:8081/artifactory/example-repo-local/{{ .ProjectName }}/{{ .Version }}/\n    custom_headers:\n      X-Checksum-MD5: "{{ md5 .ArtifactPath }}"\n      X-Checksum-SHA1: "{{ sha1 .ArtifactPath }}"\n      X-Checksum-SHA256: "{{ sha256 .ArtifactPath }}"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"customization",children:"Customization"}),"\n",(0,i.jsx)(n.p,{children:"Of course, you can customize a lot of things:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'artifactories:\n  # You can have multiple Artifactory instances.\n  - # Unique name of your artifactory instance. Used to identify the instance\n    name: production\n\n    # IDs of the artifacts you want to upload.\n    ids:\n      - foo\n      - bar\n\n    # File extensions to filter for.\n    # This might be useful if you have multiple packages with different\n    # extensions with the same ID, and need to upload each extension to\n    # a different place (e.g. nFPM packages).\n    exts:\n      - deb\n      - rpm\n\n\n    # Upload mode. Valid options are `binary` and `archive`.\n    #\n    # If mode is `archive`, variables _Os_, _Arch_ and _Arm_ for target name\n    #   are not supported. In that case these variables are empty.\n    #\n    # If mode is `binary`, you\'ll need to have the archives section setup with\n    #   format "binary" as well.\n    #\n    # Default: \'archive\'.\n    mode: archive\n\n    # URL of your Artifactory instance + path to deploy to\n    target: http://artifacts.company.com:8081/artifactory/example-repo-local/{{ .ProjectName }}/{{ .Version }}/\n\n    # Tells Kmdo not to append the artifact name to the target URL. You must do this manually\n    custom_artifact_name: true\n\n    # An optional username that will be used for the deployment for basic auth.\n    #\n    # Templates: allowed (since v2.12).\n    username: deployuser\n\n    # An optional password that will be used for the deployment for basic auth.\n    #\n    # Templates: allowed.\n    password: \'{{ readFile "~/.config/foo" }}\'\n\n    # Client certificate and key (when provided, added as client cert to TLS connections)\n    client_x509_cert: /path/to/client.cert.pem\n    client_x509_key: /path/to/client.key.pem\n\n    # A map of custom headers e.g. to support client checksums.\n    custom_headers:\n      X-Checksum-MD5: "{{ md5 .ArtifactPath }}"\n      X-Checksum-SHA1: "{{ sha1 .ArtifactPath }}"\n      X-Checksum-SHA256: "{{ sha256 .ArtifactPath }}"\n\n    # Upload checksums.\n    checksum: true\n\n    # Upload metadata.json and artifacts.json.\n    meta: true\n\n    # Upload signatures.\n    signature: true\n\n    # Skip this upload configuration.\n    #\n    # Templates: allowed.\n    skip: "{{gt .Patch 0}}"\n\n    # Certificate chain used to validate server certificates\n    trusted_certificates: |\n      -----BEGIN CERTIFICATE-----\n      MIIDrjCCApagAwIBAgIIShr2zchZo+8wDQYJKoZIhvcNAQENBQAwNTEXMBUGA1UE\n      ...(edited content)...\n      TyzMJasj5BPZrmKjJb6O/tOtEIJ66xPSBTxPShkEYHnB7A==\n      -----END CERTIFICATE-----\n\n    # You can add extra pre-existing files to the upload.\n    #\n    # The filename on the release will be the last part of the path (base).\n    # If another file with the same name exists, the last one found will be used.\n    # These globs can also include templates.\n    #\n    extra_files:\n      - glob: ./path/to/file.txt\n      - glob: ./glob/**/to/**/file/**/*\n      - glob: ./glob/foo/to/bar/file/foobar/override_from_previous\n      - glob: ./single_file.txt\n        # Templates: allowed.\n        name_template: file.txt # note that this only works if glob matches 1 file only\n\n\n    # Upload only the files defined in extra_files.\n    #\n    extra_files_only: true\n'})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var a=t(6540);const i={},r=a.createContext(i);function o(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4749],{2479:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"tutorial/pub/builds/go","title":"Go","description":"Builds can be customized in multiple ways.","source":"@site/docs/tutorial/pub/builds/go.mdx","sourceDirName":"tutorial/pub/builds","slug":"/tutorial/pub/builds/go","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/go","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Deno","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/deno"},"next":{"title":"Build Hooks","permalink":"/kmdo/zh-cn/docs/tutorial/pub/builds/hooks"}}');var s=i(4848),t=i(8453);const r={},d="Go",a={},l=[{value:"Understanding <code>GOMAXPROCS</code> in Kmdo",id:"understanding-gomaxprocs-in-kmdo",level:2},{value:"<code>GOMAXPROCS</code> for Kmdo",id:"gomaxprocs-for-kmdo",level:3},{value:"<code>GOMAXPROCS</code> for <code>go build</code> commands",id:"gomaxprocs-for-go-build-commands",level:3},{value:"Example",id:"example",level:3},{value:"Passing environment variables to ldflags",id:"passing-environment-variables-to-ldflags",level:2},{value:"Go Modules",id:"go-modules",level:2},{value:"Reproducible Builds",id:"reproducible-builds",level:2},{value:"A note about directory names inside <code>dist</code>",id:"a-note-about-directory-names-inside-dist",level:2},{value:"Why is there a <code>_v1</code> suffix on <code>amd64</code> builds?",id:"why-is-there-a-_v1-suffix-on-amd64-builds",level:3},{value:"Go&#39;s first class ports",id:"gos-first-class-ports",level:2},{value:"Building shared or static libraries",id:"building-shared-or-static-libraries",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"go",children:"Go"})}),"\n",(0,s.jsx)(n.p,{children:"Builds can be customized in multiple ways."}),"\n",(0,s.jsxs)(n.p,{children:["You can specify for which ",(0,s.jsx)(n.code,{children:"GOOS"}),", ",(0,s.jsx)(n.code,{children:"GOARCH"})," and ",(0,s.jsx)(n.code,{children:"GOARM"})," binaries are built\n(Kmdo will generate a matrix of all combinations), and you can change\nthe name of the binary, flags, environment variables, hooks and more."]}),"\n",(0,s.jsxs)(n.p,{children:["Here is a commented ",(0,s.jsx)(n.code,{children:"builds"})," section with all fields specified:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  # You can have multiple builds defined as a yaml list\n  - #\n    # ID of the build.\n    #\n    # Default: Project directory name.\n    id: "my-build"\n\n    # Path to main.go file or main package.\n    # Notice: when used with `gomod.proxy`, this must be a package.\n    #\n    # Default: `.`.\n    main: ./cmd/my-app\n\n    # Binary name.\n    # Can be a path (e.g. `bin/app`) to wrap the binary in a directory.\n    #\n    # Default: Project directory name.\n    binary: program\n\n    # Custom flags.\n    #\n    # Templates: allowed.\n    flags:\n      - -tags=dev\n      - -v\n\n    # Custom asmflags.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies\n    # and https://pkg.go.dev/cmd/asm\n    #\n    # Templates: allowed.\n    asmflags:\n      - -D mysymbol\n      - all=-trimpath={{.Env.GOPATH}}\n\n    # Custom gcflags.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies\n    # and https://pkg.go.dev/cmd/compile\n    #\n    # Templates: allowed.\n    gcflags:\n      - all=-trimpath={{.Env.GOPATH}}\n      - ./dontoptimizeme=-N\n\n    # Custom ldflags.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies\n    # and https://pkg.go.dev/cmd/link\n    #\n    # Default: \'-s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}} -X main.builtBy=kmdo\'.\n    # Templates: allowed.\n    ldflags:\n      - -s -w -X main.build={{.Version}}\n      - ./usemsan=-msan\n\n    # Custom Go build mode.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Build_modes\n    #\n    # Valid options:\n    # - `c-shared`\n    # - `c-archive`\n    # - `pie`\n    buildmode: c-shared\n\n    # Custom build tags templates.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Build_constraints\n    tags:\n      - osusergo\n      - netgo\n      - static_build\n      - feature\n\n    # Custom environment variables to be set during the builds.\n    # Invalid environment variables will be ignored.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    #\n    # Default: os.Environ() ++ env config section.\n    # Templates: allowed.\n    env:\n      - CGO_ENABLED=0\n      # complex, templated envs:\n      - >-\n        {{- if eq .Os "darwin" }}\n          {{- if eq .Arch "amd64"}}CC=o64-clang{{- end }}\n          {{- if eq .Arch "arm64"}}CC=aarch64-apple-darwin20.2-clang{{- end }}\n        {{- end }}\n        {{- if eq .Os "windows" }}\n          {{- if eq .Arch "amd64" }}CC=x86_64-w64-mingw32-gcc{{- end }}\n        {{- end }}\n\n    # GOOS list to build for.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    #\n    # Default: [ \'darwin\', \'linux\', \'windows\' ].\n    goos:\n      - freebsd\n      - windows\n\n    # GOARCH to build for.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    #\n    # Default: [ \'386\', \'amd64\', \'arm64\' ].\n    goarch:\n      - amd64\n      - arm\n      - arm64\n\n    # GOARM to build for when GOARCH is arm.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    # and https://go.dev/wiki/MinimumRequirements#microarchitecture-support\n    #\n    # Default: [ 6 ].\n    goarm:\n      - 6\n      - 7\n\n    # GOAMD64 to build when GOARCH is amd64.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    # and https://go.dev/wiki/MinimumRequirements#microarchitecture-support\n    #\n    # Default: [ \'v1\' ].\n    goamd64:\n      - v2\n      - v3\n\n    # GOARM64 to build when GOARCH is arm64.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    # and https://go.dev/wiki/MinimumRequirements#microarchitecture-support\n    #\n    # Default: [ \'v8.0\' ].\n    goarm64:\n      - v9.0\n\n    # GOMIPS and GOMIPS64 to build when GOARCH is mips, mips64, mipsle or mips64le.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    # and https://go.dev/wiki/MinimumRequirements#microarchitecture-support\n    #\n    # Default: [ \'hardfloat\' ].\n    gomips:\n      - hardfloat\n      - softfloat\n\n    # GO386 to build when GOARCH is 386.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    # and https://go.dev/wiki/MinimumRequirements#microarchitecture-support\n    #\n    # Default: [ \'sse2\' ].\n    go386:\n      - sse2\n      - softfloat\n\n    # GOPPC64 to build when GOARCH is PPC64.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    # and https://go.dev/wiki/MinimumRequirements#microarchitecture-support\n    #\n    # Default: [ \'power8\' ].\n\n    goppc64:\n      - power8\n      - power9\n\n    # GORISCV64 to build when GOARCH is RISCV64.\n    # For more info refer to: https://pkg.go.dev/cmd/go#hdr-Environment_variables\n    # and https://go.dev/wiki/MinimumRequirements#microarchitecture-support\n    #\n    # Default: [ \'rva20u64\' ].\n    goriscv64:\n      - rva22u64\n\n    # List of combinations of GOOS + GOARCH + GOARM to ignore.\n    ignore:\n      - goos: darwin\n        goarch: 386\n      - goos: linux\n        goarch: arm\n        goarm: 7\n      - goarm: mips64\n      - gomips: hardfloat\n      - goamd64: v4\n\n    # Optionally override the matrix generation and specify only the final list\n    # of targets.\n    #\n    # Format is `{goos}_{goarch}` with their respective suffixes when\n    # applicable: `_{goarm}`, `_{goamd64}`, `_{gomips}`, `_{go386}`,\n    #             `_{goriscv64}`, `_{goarm64}`, `_{goppc64}`.\n    #\n    # Special values:\n    # - go_118_first_class: evaluates to the first-class ports of go1.18.\n    # - go_first_class: evaluates to latest stable go first-class ports,\n    #   currently same as 1.18.\n    #\n    # This overrides `goos`, `goarch`, `goarm`, `gomips`, `goamd64`, `go386`,\n    #                `goriscv64`, `goarm64`, `goppc64`, and `ignores`.\n    targets:\n      - go_first_class\n      - go_118_first_class\n      - linux_amd64_v1\n      - darwin_arm64\n      - linux_arm_6\n\n    # Set a specific go binary to use when building.\n    # It is safe to ignore this option in most cases.\n    #\n    # Default: "go".\n    # Templates: allowed.\n    tool: "go1.13.4"\n\n    # Sets the command to run to build.\n    # Can be useful if you want to build tests, for example,\n    # in which case you can set this to "test".\n    # It is safe to ignore this option in most cases.\n    #\n    # Default: build.\n    command: test\n\n    # Set the modified timestamp on the output binary, typically\n    # you would do this to ensure a build was reproducible.\n    # Pass an empty string to skip modifying the output.\n    #\n    # Templates: allowed.\n    mod_timestamp: "{{ .CommitTimestamp }}"\n\n    # Hooks can be used to customize the final binary,\n    # for example, to run generators.\n    #\n    # Templates: allowed.\n    hooks:\n      pre: rice embed-go\n      post: ./script.sh {{ .Path }}\n\n    # If true, skip the build.\n    # Useful for library projects.\n    skip: false\n\n    # By default, Kmdo will create your binaries inside\n    # `dist/${BuildID}_${BuildTarget}`, which is a unique directory per build\n    # target in the matrix.\n    # You can set subdirs within that directory using the `binary` property.\n    #\n    # However, if for some reason you don\'t want that unique directory to be\n    # created, you can set this property.\n    # If you do, you are responsible for keeping different builds from\n    # overriding each other.\n    no_unique_dist_dir: true\n\n    # By default, Kmdo will check if the main filepath has a main\n    # function.\n    # This can be used to skip that check, in case you\'re building tests, for\n    # example.\n    no_main_check: true\n\n    # Path to project\'s (sub)directory containing Go code.\n    # This is the working directory for the Go build command(s).\n    # If dir does not contain a `go.mod` file, and you are using `gomod.proxy`,\n    # produced binaries will be invalid.\n    # You would likely want to use `main` instead of this.\n    #\n    # Default: \'.\'.\n    dir: go\n\n\n    # Overrides allows to override some fields for specific targets.\n    # This can be specially useful when using CGO.\n    #\n    # Attention: you need to set at least goos and goarch, otherwise it won\'t\n    # match anything.\n    overrides:\n      - goos: darwin\n        goarch: amd64\n        goamd64: v1\n        goarm: ""\n        goarm64: ""\n        gomips: ""\n        go386: ""\n        goriscv64: ""\n        goppc64: ""\n        ldflags:\n          - foo\n        tags:\n          - bar\n        asmflags:\n          - foobar\n        gcflags:\n          - foobaz\n        env:\n          - CGO_ENABLED=1\n\n    # Set a specific go binary to use when building.\n    # It is safe to ignore this option in most cases.\n    #\n    # Default: "go".\n    # Templates: allowed.\n    # Deprecated: use `tool` instead.\n    gobinary: "go1.13.4"\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["Learn more about ",(0,s.jsx)(n.a,{href:"/kmdo/zh-cn/docs/tutorial/pub/builds/hooks",children:"build hooks"}),"."]})}),"\n",(0,s.jsx)(n.admonition,{title:'"GOAMD64, GORISCV64, GOPPC64, GO386, GOARM, GOARM64"',type:"warning",children:(0,s.jsxs)(n.p,{children:["You usually will need to specify the complete target in places like\n",(0,s.jsx)(n.code,{children:"targets"})," and ",(0,s.jsx)(n.code,{children:"overrides"}),".\nThis includes the ",(0,s.jsx)(n.code,{children:"_{goamd64}"})," suffix, as well as the other\nGOARCH-specific values."]})}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.p,{children:"First-class build targets are gathered by running:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"go tool dist list -json | jq -r '.[] | select(.FirstClass) | [.GOOS, .GOARCH] | @tsv'\n"})}),(0,s.jsxs)(n.p,{children:["We also recommend reading the ",(0,s.jsx)(n.a,{href:"https://go.dev/wiki/PortingPolicy#first-class-ports",children:"official wiki about Go ports"}),"."]})]}),"\n",(0,s.jsx)(n.p,{children:"Here is an example with multiple binaries:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  - main: ./cmd/cli\n    id: "cli"\n    binary: cli\n    goos:\n      - linux\n      - darwin\n      - windows\n\n  - main: ./cmd/worker\n    id: "worker"\n    binary: worker\n    goos:\n      - linux\n      - darwin\n      - windows\n\n  - main: ./cmd/tracker\n    id: "tracker"\n    binary: tracker\n    goos:\n      - linux\n      - darwin\n      - windows\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The binary name field supports ",(0,s.jsx)(n.a,{href:"/kmdo/zh-cn/docs/tutorial/pub/general/templates",children:"templating"}),". The\nfollowing build details are exposed:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Key"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:".Os"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GOOS"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:".Arch"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GOARCH"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:".Arm"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GOARM"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:".Ext"}),(0,s.jsxs)(n.td,{children:["Extension, e.g. ",(0,s.jsx)(n.code,{children:".exe"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:".Target"}),(0,s.jsxs)(n.td,{children:["Build target, e.g. ",(0,s.jsx)(n.code,{children:"darwin_amd64"})]})]})]})]}),"\n",(0,s.jsxs)(n.h2,{id:"understanding-gomaxprocs-in-kmdo",children:["Understanding ",(0,s.jsx)(n.code,{children:"GOMAXPROCS"})," in Kmdo"]}),"\n",(0,s.jsxs)(n.h3,{id:"gomaxprocs-for-kmdo",children:[(0,s.jsx)(n.code,{children:"GOMAXPROCS"})," for Kmdo"]}),"\n",(0,s.jsxs)(n.p,{children:["Kmdo uses\n",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/go.uber.org/automaxprocs/maxprocs",children:(0,s.jsx)(n.code,{children:"automaxprocs"})})," to\nautomatically set ",(0,s.jsx)(n.code,{children:"GOMAXPROCS"})," based on available CPUs, including honoring\ncontainer CPU limits.\nThis determines the number of threads Kmdo itself uses internally."]}),"\n",(0,s.jsxs)(n.p,{children:["Kmdo also provides a ",(0,s.jsx)(n.code,{children:"--parallelism"})," flag to control how many internal\ntasks (e.g., builds, archives, uploads) run concurrently.\nIf ",(0,s.jsx)(n.code,{children:"--parallelism"})," is not set, Kmdo defaults to the current value of\n",(0,s.jsx)(n.code,{children:"GOMAXPROCS"}),"."]}),"\n",(0,s.jsxs)(n.h3,{id:"gomaxprocs-for-go-build-commands",children:[(0,s.jsx)(n.code,{children:"GOMAXPROCS"})," for ",(0,s.jsx)(n.code,{children:"go build"})," commands"]}),"\n",(0,s.jsxs)(n.p,{children:["Each ",(0,s.jsx)(n.code,{children:"go build"})," command launched by Kmdo inherits the environment,\nincluding ",(0,s.jsx)(n.code,{children:"GOMAXPROCS"}),".\nIf ",(0,s.jsx)(n.code,{children:"GOMAXPROCS"})," is not explicitly set, Go will default to the number of ",(0,s.jsx)(n.strong,{children:"host"}),"\nCPUs."]}),"\n",(0,s.jsxs)(n.p,{children:["If you're running inside a container and want to respect CPU limits during\nbuilds, you must set ",(0,s.jsx)(n.code,{children:"GOMAXPROCS"})," manually."]}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(n.p,{children:["If you want Kmdo to run up to 10 tasks in parallel, but restrict ",(0,s.jsx)(n.code,{children:"go build"})," to use only 2 threads:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"GOMAXPROCS=2 Kmdo release --parallelism=10\n"})}),"\n",(0,s.jsx)(n.p,{children:"This configures:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Kmdo to run up to 10 internal tasks concurrently"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"go build"})," subprocesses to use only 2 OS threads"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"passing-environment-variables-to-ldflags",children:"Passing environment variables to ldflags"}),"\n",(0,s.jsxs)(n.p,{children:["You can do that by using ",(0,s.jsx)(n.code,{children:"{{ .Env.VARIABLE_NAME }}"})," in the template, for\nexample:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  - ldflags:\n   - -s -w -X "main.goversion={{.Env.GOVERSION}}"\n'})}),"\n",(0,s.jsx)(n.p,{children:"Then you can run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"GOVERSION=$(go version) kmdo\n"})}),"\n",(0,s.jsx)(n.h2,{id:"go-modules",children:"Go Modules"}),"\n",(0,s.jsx)(n.p,{children:"If you use Go 1.11+ with go modules or vgo, when Kmdo runs it may try to\ndownload the dependencies. Since several builds run in parallel, it is very\nlikely to fail."}),"\n",(0,s.jsxs)(n.p,{children:["You can solve this by running ",(0,s.jsx)(n.code,{children:"go mod tidy"})," before calling ",(0,s.jsx)(n.code,{children:"kmdo"})," or\nby adding a ",(0,s.jsx)(n.a,{href:"/kmdo/zh-cn/docs/tutorial/pub/general/hooks",children:"hook"})," doing that on your ",(0,s.jsx)(n.code,{children:".kmdopkg.yaml"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:"before:\n  hooks:\n    - go mod tidy\n# rest of the file...\n"})}),"\n",(0,s.jsx)(n.h2,{id:"reproducible-builds",children:"Reproducible Builds"}),"\n",(0,s.jsx)(n.p,{children:"To make your releases, checksums and signatures reproducible, you will need to\nmake some (if not all) of the following modifications to the build defaults in\nKmdo:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Modify ",(0,s.jsx)(n.code,{children:"ldflags"}),": by default ",(0,s.jsx)(n.code,{children:"main.Date"})," is set to the time Kmdo is run\n(",(0,s.jsx)(n.code,{children:"{{.Date}}"}),"), you can set this to ",(0,s.jsx)(n.code,{children:"{{.CommitDate}}"})," or just not pass the\nvariable."]}),"\n",(0,s.jsxs)(n.li,{children:["Modify ",(0,s.jsx)(n.code,{children:"mod_timestamp"}),": by default this is empty string \u2014 which means it'll be\nthe compilation time, set to ",(0,s.jsx)(n.code,{children:"{{.CommitTimestamp}}"})," or a constant value\ninstead."]}),"\n",(0,s.jsxs)(n.li,{children:["If you do not run your builds from a consistent directory structure, pass\n",(0,s.jsx)(n.code,{children:"-trimpath"})," to ",(0,s.jsx)(n.code,{children:"flags"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Remove uses of the ",(0,s.jsx)(n.code,{children:"time"})," template function. This function returns a new value\non every call and is not deterministic."]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"a-note-about-directory-names-inside-dist",children:["A note about directory names inside ",(0,s.jsx)(n.code,{children:"dist"})]}),"\n",(0,s.jsxs)(n.p,{children:["By default, Kmdo will create your binaries inside\n",(0,s.jsx)(n.code,{children:"dist/${BuildID}_${BuildTarget}"}),", which is a unique directory per build target\nin the matrix."]}),"\n",(0,s.jsxs)(n.p,{children:["Those names have no guarantees of remaining the same from one version to\nanother. If you really need to access them from outside Kmdo, you should\nbe able to consistently get the path of a binary by parsing\n",(0,s.jsx)(n.code,{children:"dist/artifacts.json"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["You can also set ",(0,s.jsx)(n.code,{children:"builds.no_unique_dist_dir"})," (as documented earlier in this\npage), but in that case you are responsible for preventing name conflicts."]}),"\n",(0,s.jsxs)(n.h3,{id:"why-is-there-a-_v1-suffix-on-amd64-builds",children:["Why is there a ",(0,s.jsx)(n.code,{children:"_v1"})," suffix on ",(0,s.jsx)(n.code,{children:"amd64"})," builds?"]}),"\n",(0,s.jsxs)(n.p,{children:["Go 1.18 introduced the ",(0,s.jsx)(n.code,{children:"GOAMD64"})," option, and ",(0,s.jsx)(n.code,{children:"v1"})," is the default value for that\noption."]}),"\n",(0,s.jsxs)(n.p,{children:["Since you can have Kmdo build for multiple different ",(0,s.jsx)(n.code,{children:"GOAMD64"})," targets, it\nadds that suffix to prevent name conflicts. The same thing happens for ",(0,s.jsx)(n.code,{children:"arm"})," and\n",(0,s.jsx)(n.code,{children:"GOARM"}),", ",(0,s.jsx)(n.code,{children:"mips"})," and ",(0,s.jsx)(n.code,{children:"GOMIPS"})," and others."]}),"\n",(0,s.jsx)(n.h2,{id:"gos-first-class-ports",children:"Go's first class ports"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"targets"})," option can take a ",(0,s.jsx)(n.code,{children:"go_first_class"})," special value as target, which\nwill evaluate to the list of first class ports as defined in the Go wiki."]}),"\n",(0,s.jsxs)(n.p,{children:["You can read more about it\n",(0,s.jsx)(n.a,{href:"https://go.dev/wiki/PortingPolicy#first-class-ports",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"building-shared-or-static-libraries",children:"Building shared or static libraries"}),"\n",(0,s.jsxs)(n.p,{children:["Kmdo supports compiling and releasing C shared or static libraries, by\nconfiguring the ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/cmd/go#hdr-Build_modes",children:"Go build mode"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["This can be set with ",(0,s.jsx)(n.code,{children:"buildmode"})," in your build.\nIt now supports ",(0,s.jsx)(n.code,{children:"c-shared"})," and ",(0,s.jsx)(n.code,{children:"c-archive"}),". Other values will transparently be\napplied to the build line (via the ",(0,s.jsx)(n.code,{children:"-buildmode"})," flag), but Kmdo will not\nattempt to configure any additional logic."]}),"\n",(0,s.jsx)(n.p,{children:"Kmdo will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"set the correct file extension for the target OS."}),"\n",(0,s.jsxs)(n.li,{children:["package the generated header file (",(0,s.jsx)(n.code,{children:".h"}),") in the release bundle."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".kmdopkg.yaml"',children:'builds:\n  - id: "my-library"\n\n    # Configure the buildmode flag to output a shared library\n    buildmode: "c-shared" # or "c-archive" for a static library\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>d});var o=i(6540);const s={},t=o.createContext(s);function r(e){const n=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);
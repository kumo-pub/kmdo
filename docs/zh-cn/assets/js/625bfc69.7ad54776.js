"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[288],{1598:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"shooting/docker-build","title":"Docker build failures","description":"COPY failed: file not found in build context","source":"@site/docs/shooting/docker-build.md","sourceDirName":"shooting","slug":"/shooting/docker-build","permalink":"/zh-cn/docs/shooting/docker-build","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"shootingSidebar","previous":{"title":"dirty","permalink":"/zh-cn/docs/shooting/dirty"},"next":{"title":"Archive has different count of binaries for each platform","permalink":"/zh-cn/docs/shooting/multiple-binaries-archive"}}');var i=o(4848),d=o(8453);const c={},s="Docker build failures",r={},l=[{value:"<code>COPY failed: file not found in build context</code>",id:"copy-failed-file-not-found-in-build-context",level:2},{value:"<code>expected to find X artifacts for ids [id1 id2], found Y</code>",id:"expected-to-find-x-artifacts-for-ids-id1-id2-found-y",level:2},{value:"<code>use docker --context=default buildx to switch to context &quot;default&quot;</code>",id:"use-docker---contextdefault-buildx-to-switch-to-context-default",level:2},{value:"Don&#39;t",id:"dont",level:3},{value:"Don&#39;t",id:"dont-1",level:3},{value:"Do",id:"do",level:3}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"docker-build-failures",children:"Docker build failures"})}),"\n",(0,i.jsx)(n.h2,{id:"copy-failed-file-not-found-in-build-context",children:(0,i.jsx)(n.code,{children:"COPY failed: file not found in build context"})}),"\n",(0,i.jsx)(n.p,{children:"This usually happens when trying to build the binary again from source code in\nthe Docker image build process."}),"\n",(0,i.jsxs)(n.p,{children:["The way Kmdo works, the correct binary for the platform you're building\nshould be already available, so you don't need to build it again and can still\nreuse the ",(0,i.jsx)(n.code,{children:"Dockerfile"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Another common misconception is trying to copy the binary as if the context is\nthe repository root.\nIt's not.\nIt's always a new temporary build context with the artifacts you can use in\nits root, so you can just ",(0,i.jsx)(n.code,{children:"COPY binaryname /bin/binaryname"})," and etc."]}),"\n",(0,i.jsxs)(n.p,{children:["Below you can find some ",(0,i.jsx)(n.strong,{children:"don'ts"})," as well as what you should ",(0,i.jsx)(n.strong,{children:"do"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"expected-to-find-x-artifacts-for-ids-id1-id2-found-y",children:(0,i.jsx)(n.code,{children:"expected to find X artifacts for ids [id1 id2], found Y"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ids"})," property in the Dockers configuration tells Kmdo which build IDs\nto include.\nYou need to remove IDs that don't exist and/or don't build for the architecture\nof the image being built.\nLeaving it empty is also fine if you don't need any binaries."]}),"\n",(0,i.jsx)(n.h2,{id:"use-docker---contextdefault-buildx-to-switch-to-context-default",children:(0,i.jsx)(n.code,{children:'use docker --context=default buildx to switch to context "default"'})}),"\n",(0,i.jsxs)(n.p,{children:['The "default" context is a built-in context in "docker buildx", and it is automatically created. This context typically points to the local Docker environment and is used by default for building images. It has to be active for ',(0,i.jsx)(n.code,{children:"kmdo"}),' to build images with "buildx".']}),"\n",(0,i.jsxs)(n.p,{children:["You can switch to the default context using ",(0,i.jsx)(n.code,{children:"docker context use default"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This change should be persistent."}),"\n",(0,i.jsx)(n.h3,{id:"dont",children:"Don't"}),"\n",(0,i.jsx)(n.p,{children:"Build the binary again."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dockerfile",children:'FROM golang AS builder\nWORKDIR /app\nCOPY cmd ./cmd\nCOPY go.mod ./\nCOPY *.go ./\nRUN GOOS=linux GOARCH=amd64 go build -ldflags="-w -s" -o app .\n\nFROM scratch\nCOPY --from=builder /app/app /app\nENTRYPOINT ["/app"]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"dont-1",children:"Don't"}),"\n",(0,i.jsxs)(n.p,{children:["Copy from the ",(0,i.jsx)(n.code,{children:"dist"})," directory."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dockerfile",children:'FROM scratch\nCOPY /dist/app_linux_amd64/app /app\nENTRYPOINT ["/app"]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"do",children:"Do"}),"\n",(0,i.jsx)(n.p,{children:"Copy the clean file names from the root."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dockerfile",children:'FROM scratch\nCOPY app /app\nENTRYPOINT ["/app"]\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["If you still want your users to be able to ",(0,i.jsx)(n.code,{children:"docker build"})," without an extra\nstep, you can have a ",(0,i.jsx)(n.code,{children:"Dockerfile"})," just for Kmdo, for example, a\n",(0,i.jsx)(n.code,{children:"kmdo.dockerfile"}),"."]})})]})}function u(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>c,x:()=>s});var t=o(6540);const i={},d=t.createContext(i);function c(e){const n=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(d.Provider,{value:n},e.children)}}}]);
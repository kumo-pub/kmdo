---
title: Arch 用户仓库
sidebar:
  label: Arch 用户仓库
description: 'Arch 用户仓库 configuration.'
i18nReady: true
---
# Arch 用户仓库

在 GitHub、GitLab 或 Gitea 发布产物后，kmdo 可生成并发布 `PKGBUILD` 文件至 Arch 用户仓库（Arch User Repository，AUR）。

:::tip

    继续操作前，请务必阅读
    [AUR 提交指南](https://wiki.archlinux.org/title/AUR_submission_guidelines)。
:::

This page describes the available options.

```yaml title=".kmdopkg.yaml"
aurs:
  - # 软件包名称
    #
    # 注意：根据 Arch 社区规范，由于此集成不创建从源代码构建的 PKGBUILD，
    # kmdo 会自动为名称添加 `-bin` 后缀（若未手动指定）
    #
    # 默认值：项目名称 + -bin 后缀
    name: package-bin

    # 需过滤的产物 ID 列表
    # 留空表示匹配所有 ID（无过滤）
    ids:
      - foo
      - bar

    # 应用的主页 URL
    #
    # 默认值：从全局元数据中推导
    homepage: "https://example.com/"

    # 应用的描述信息
    #
    # 支持模板语法
    # 默认值：从全局元数据中推导
    description: "用于快速创建简单鼓点节奏的软件"

    # 软件包维护者信息
    #
    # 默认值：从全局元数据中推导
    maintainers:
      - "Foo Bar <foo at bar dot com>"

    # 软件包贡献者信息
    contributors:
      - "Foo Zaz <foo at zaz dot com>"

    # 应用许可证的 SPDX 标识符
    #
    # 默认值：从全局元数据中推导
    license: "MIT"

    # 用于向 Git 仓库提交代码的 SSH 私钥
    # 可填写文件路径或密钥内容
    #
    # 重要：该密钥必须无密码保护
    # 警告：切勿在配置文件中直接暴露私钥！
    private_key: "{{ .Env.AUR_KEY }}"

    # 该软件包对应的 AUR Git 仓库地址
    # 留空则跳过发布步骤
    git_url: "ssh://aur@aur.archlinux.org/mypackage-bin.git"

    # 启用后，kmdo 不会实际提交更新后的 PKGBUILD
    # 仅将生成的文件保存到 dist 目录，由用户自行负责发布
    #
    # 若设为 auto：当标签包含预发布标识（如 v1.0.0-rc1）时，不会上传至 AUR 仓库
    skip_upload: true

    # 该软件包提供功能对应的其他软件包列表
    #
    # 默认值：项目名称
    provides:
      - mybin

    # 与该软件包冲突或会导致问题的软件包列表
    #
    # 默认值：项目名称
    conflicts:
      - mybin

    # 安装该软件包必须依赖的软件包列表
    depends:
      - curl

    # 非软件运行必需，但可提供额外功能的软件包列表
    #
    # 格式要求：`软件包名: 额外功能的简要描述`
    optdepends:
      - "wget: 用于下载文件"

    # 包含用户自定义修改、升级或卸载时需保留的文件列表
    backup:
      - /etc/foo.conf

    # 自定义软件包安装指令
    # kmdo 的默认安装指令可能并非适用于所有场景，建议手动覆盖
    # 需包含二进制文件、许可证及其他依赖文件的安装逻辑
    #
    # 默认值：'install -Dm755 "./项目名称" "${pkgdir}/usr/bin/项目名称"'
    package: |-
      # 安装二进制文件
      install -Dm755 "./mybin" "${pkgdir}/usr/bin/mybin"

      # 安装许可证文件
      install -Dm644 "./LICENSE.md" "${pkgdir}/usr/share/licenses/mybin/LICENSE"

      # 安装命令补全脚本
      mkdir -p "${pkgdir}/usr/share/bash-completion/completions/"
      mkdir -p "${pkgdir}/usr/share/zsh/site-functions/"
      mkdir -p "${pkgdir}/usr/share/fish/vendor_completions.d/"
      install -Dm644 "./completions/mybin.bash" "${pkgdir}/usr/share/bash-completion/completions/mybin"
      install -Dm644 "./completions/mybin.zsh" "${pkgdir}/usr/share/zsh/site-functions/_mybin"
      install -Dm644 "./completions/mybin.fish" "${pkgdir}/usr/share/fish/vendor_completions.d/mybin.fish"

      # 安装手册页
      install -Dm644 "./manpages/mybin.1.gz" "${pkgdir}/usr/share/man/man1/mybin.1.gz"

    # 生成名为 '软件包名.install' 的安装脚本文件
    # 可在该文件中定义 pre_install、post_install 等钩子函数
    #
    # <!-- md:inline_version v2.8 -->（v2.8 及以上版本支持）
    install: ./scripts/install.sh

    # Git 提交信息
    #
    # 默认值：'Update to {{ .Tag }}'（更新至指定版本）
    # 支持模板语法
    commit_msg_template: "pkgbuild 更新"

    # 若为多个 GOAMD64 版本构建产物，可通过此配置选择使用的版本
    #
    # 默认值：'v1'
    goamd64: v2

    # 传递给 `GIT_SSH_COMMAND` 的值
    # 主要用于指定拉取/推送 Git 仓库时使用的 SSH 私钥
    #
    # 默认值：'ssh -i {{ .KeyPath }} -o StrictHostKeyChecking=accept-new -F /dev/null'
    git_ssh_command: "ssh -i {{ .Env.KEY }} -o SomeOption=yes"

    # 基于指定 Token 确定的产物下载 URL
    # 支持 github、gitlab 或 gitea 平台
    #
    # 默认值：根据客户端自动推导
    # 支持模板语法
    url_template: "http://github.mycompany.com/foo/bar/releases/{{ .Tag }}/{{ .ArtifactName }}"

    # 仓库中创建文件的目标目录
    # 仅适用于单仓库包含多个软件包的自定义 AUR 场景
    #
    # 默认值：'.'（仓库根目录）
    # 支持模板语法
    directory: "."

    # 是否禁用当前 AUR 配置
    #
    # 支持模板语法
    # <!-- md:inline_version v2.8 -->（v2.8 及以上版本支持）
    disable: "{{ .IsSnapshot }}"

    # 用于提交代码的 Git 作者信息
    #
    # 默认值：从全局元数据中推导（v2.12 及以上版本支持）
    commit_author:
      # Git 作者名称
      #
      # 支持模板语法
      name: kmdobot

      # Git 作者邮箱
      #
      # 支持模板语法
      email: bot@kmdo.com

      # Git 提交签名配置
      # 仅适用于 'git' 类型的仓库
      #
      # <!-- md:inline_version v2.11 -->（v2.11 及以上版本支持）
      signing:
        # 启用提交签名
        enabled: true

        # 用于签名的密钥
        # 可填写密钥 ID、指纹、邮箱地址或密钥文件路径
        #
        # 支持模板语法
        key: "{{ .Env.GPG_SIGNING_KEY }}"

        # 用于签名的 GPG 程序
        #
        # 支持模板语法
        program: gpg2

        # 签名格式
        #
        # 有效值：openpgp、x509、ssh
        # 默认值：openpgp
        format: openpgp
```


:::tip

    有关各字段的详细说明，请参考
    [Arch 的 PKGBUILD 参考文档](https://wiki.archlinux.org/title/PKGBUILD)。
:::

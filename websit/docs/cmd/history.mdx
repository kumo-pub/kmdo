---
slug: /cmd/history
---
# kmdo history 命令文档

## 概述
kmdo history 命令用于显示或清理 kmdo 命令的执行历史记录，默认存储最新100条记录，支持自定义显示条数和清空历史操作。历史记录自动存储在 $HOME/.kmdo/history 文件中（跨平台兼容）。

## 命令结构
kmdo history [FLAGS]

## 核心功能
1. 显示命令执行历史（默认最新100条）
2. 自定义显示历史记录的条数
3. 清空所有命令执行历史记录
4. 自动记录所有 kmdo 子命令执行记录（排除 help/history 命令）

## 命令 Flags 说明
| Flag | 简写 | 类型 | 默认值 | 描述 |
|------|------|------|--------|------|
| --limit | -l | 整数 | 100 | 指定要显示的历史记录条数（如 --limit 50 显示最新50条） |
| --clean | -c | 布尔值 | false | 清空所有命令历史记录（执行后历史文件将被删除，新记录会自动重建） |

## 详细命令说明

### 1. 显示命令历史记录
#### 功能
读取并展示 kmdo 命令执行历史，支持自定义显示条数，输出包含记录序号、时间戳和完整命令。

#### 用法
# 显示默认最新100条历史记录
kmdo history

# 显示最新50条历史记录（通过 --limit 指定）
kmdo history --limit 50
# 或简写
kmdo history -l 50

#### 示例
# 显示默认100条历史
kmdo history

# 显示最新10条历史
kmdo history -l 10

#### 输出说明
- 存在历史记录时输出：
kmdo command history (latest 10 records):
----------------------------------------
   1  [2024-05-20T14:30:00+08:00] kmdo env show PATH
   2  [2024-05-20T15:10:22+08:00] kmdo env init -f
   3  [2024-05-21T09:45:18+08:00] kmdo history -l 20
...

- 无历史记录时输出：
No command history found

### 2. 清空命令历史记录
#### 功能
删除存储历史记录的文件（$HOME/.kmdo/history），实现历史记录全量清空，后续新命令执行会自动重建历史文件。

#### 用法
# 清空所有命令历史
kmdo history --clean
# 或简写
kmdo history -c

#### 示例
# 执行清空操作
kmdo history -c

#### 输出说明
- 存在历史记录时输出：
Command history cleaned successfully

- 无历史记录时输出：
No command history to clean

## 历史记录存储说明
1. 存储路径：历史记录文件位于 $HOME/.kmdo/history（$HOME 为系统用户主目录，跨平台自动适配）
2. 记录格式：[时间戳（RFC3339格式）] 完整命令（含子命令和参数）
3. 自动创建：首次执行 kmdo 子命令时，会自动创建 .kmdo 目录和 history 文件
4. 权限设置：历史文件权限为 0644（仅所有者可读写，其他用户只读），目录权限为 0755

## 自动记录规则
1. 所有 kmdo 子命令执行后会自动记录到历史文件（PersistentPostRunE 钩子实现）
2. 跳过记录的场景：
   - 执行 help 命令（含 --help 标志）
   - 执行 history 命令本身
   - 仅输入 kmdo 无任何子命令或参数
3. 记录内容：完整命令路径（含父命令）+ 所有参数，例如 kmdo env init -f 会完整记录

## 注意事项
1. 使用 --clean 标志会永久删除历史文件，执行前请确认无需保留历史记录
2. 历史记录仅存储在本地，不会上传或同步到其他设备
3. 若历史文件被手动删除，重新执行 kmdo 子命令会自动重建，新记录从重建后开始存储
4. 显示历史时，空行记录会被自动过滤，仅展示有效命令记录
---
slug: /cmd/pkg/check
---

# kmdo pkg check 命令文档
## 概述
kmdo pkg check 命令用于校验 kmdo 包配置文件的有效性，支持单个或多个 YAML/yml 配置文件校验，核心检查配置格式合规性、字段完整性及是否包含废弃属性，输出明确的校验结果和错误信息，帮助提前发现配置问题，避免构建/发布时失败。

## 命令结构
kmdo pkg check [configuration files] [FLAGS]
kmdo pkg c [configuration files] [FLAGS]  # 简写形式

## 核心功能
1. 校验配置文件的格式有效性（是否符合 YAML 规范）。
2. 检查配置字段的完整性和合规性（是否符合 kmdo 包配置要求）。
3. 检测配置中是否使用废弃属性（可选触发）。
4. 支持批量校验多个配置文件，输出汇总结果。
5. 提供静默模式，仅返回校验状态（无冗余输出）。

## 命令 Flags 说明
| Flag | 简写 | 类型 | 默认值 | 描述 |
|------|------|------|--------|------|
| --config | -f | 字符串 | "" | 待校验的配置文件路径（支持 yaml/yml 格式，默认隐藏，推荐直接在参数中指定文件） |
| --quiet | -q | 布尔值 | false | 静默模式：不输出任何日志，仅通过退出码表示校验结果 |
| --deprecated | - | 布尔值 | false | 强制打印废弃属性提示（仅测试用，默认隐藏） |

## 关键参数说明
### 位置参数（configuration files）
- 直接指定一个或多个待校验的配置文件路径（支持相对路径和绝对路径）。
- 支持文件扩展名过滤，仅识别 yaml/yml 格式文件。
- 若未指定位置参数且未使用 --config，默认校验项目内的 .kmdopkg.yaml。

## 退出码说明
| 退出码 | 含义 |
|--------|------|
| 0 | 所有配置文件校验通过（无格式错误、无废弃属性） |
| 1 | 至少一个配置文件格式无效或字段不合规 |
| 2 | 配置文件格式有效，但包含废弃属性（仅 --deprecated 模式下触发） |

## 详细使用场景与说明
### 场景1：校验单个配置文件
#### 功能
校验指定的单个 kmdo 包配置文件是否有效。
#### 用法

```shell
kmdo pkg check <配置文件路径>
#### 示例
# 校验项目内默认配置文件
kmdo pkg check .kmdopkg.yaml

# 校验自定义路径的配置文件
kmdo pkg check ./configs/my-pkg.yaml
```

#### 成功输出
ℹ️  checking .kmdopkg.yaml
✅ 1 configuration file(s) validated

#### 失败输出（格式错误）
❌ .kmdopkg.yaml: configuration is invalid: yaml: line 5: did not find expected key

### 场景2：批量校验多个配置文件
#### 功能
一次性校验多个配置文件，汇总校验结果。
#### 用法
```shell
kmdo pkg check <文件1> <文件2> ... <文件N>
#### 示例
kmdo pkg check .kmdopkg.yaml ./test/config1.yaml ./test/config2.yaml

#### 输出（部分文件失败）
ℹ️  checking .kmdopkg.yaml
ℹ️  checking ./test/config1.yaml
❌ ./test/config1.yaml: configuration is invalid: missing required field "builds"
ℹ️  checking ./test/config2.yaml
❌ 1 out of 3 configuration file(s) have issues
```

### 场景3：静默模式校验（脚本自动化）
#### 功能
静默模式下不输出日志，仅通过退出码判断校验结果，适用于脚本自动化场景。
#### 用法
```shell
kmdo pkg check --quiet <配置文件路径>
#### 示例（脚本中使用）
if kmdo pkg check --quiet .kmdopkg.yaml; then
  echo "配置文件有效，继续构建"
else
  echo "配置文件无效，终止流程"
  exit 1
fi
```
## 注意事项
1. 文件格式限制：仅支持校验 yaml/yml 格式文件，其他格式会报错。
2. 路径优先级：若同时指定位置参数和 --config，会合并所有文件进行校验。
3. 静默模式：--quiet 模式下，无论校验成功或失败，均无日志输出，仅通过退出码判断。
4. 废弃属性检测：默认不检测废弃属性，仅 --deprecated 模式下会触发并返回退出码 2（测试用）。
5. 必需字段校验：校验逻辑会检查配置文件中的必需字段（如 builds），缺失会判定为无效。

要不要我帮你整理一份 **纯文本格式的kmdo-pkg-check命令自动化脚本示例**，包含单文件校验、多文件校验和静默模式脚本，方便直接嵌入到CI/CD流水线或自动化脚本中？